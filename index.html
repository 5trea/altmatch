<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Alt Match - App de Rencontre</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            overflow-x: hidden;
            overflow-y: auto;
            transition: background 0.3s ease;
        }

      
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes bounceIn {
            0% {
                transform: scale(0);
                opacity: 0;
            }
            50% {
                transform: scale(1.1);
            }
            100% {
                transform: scale(1);
                opacity: 1;
            }
        }

        @keyframes float-around {
            0%, 100% {
                transform: translate(0, 0) rotate(0deg);
            }
            25% {
                transform: translate(30px, -30px) rotate(90deg);
            }
            50% {
                transform: translate(-20px, 20px) rotate(180deg);
            }
            75% {
                transform: translate(20px, 30px) rotate(270deg);
            }
        }

        
        .hidden {
            display: none !important;
        }

      
        #welcome-screen {
            min-height: 100vh;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
        }

        .welcome-container {
            max-width: 600px;
            width: 100%;
            padding: 40px 20px;
            text-align: center;
            position: relative;
            z-index: 2;
        }

        .floating-fruits {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            pointer-events: none;
        }

        .floating-fruit {
            position: absolute;
            font-size: 60px;
            animation: float-around 20s infinite;
            opacity: 0.3;
        }

        .floating-fruit:nth-child(1) {
            top: 10%;
            left: 10%;
            animation-delay: 0s;
        }

        .floating-fruit:nth-child(2) {
            top: 20%;
            right: 15%;
            animation-delay: 2s;
        }

        .floating-fruit:nth-child(3) {
            bottom: 30%;
            left: 20%;
            animation-delay: 4s;
        }

        .floating-fruit:nth-child(4) {
            bottom: 20%;
            right: 10%;
            animation-delay: 6s;
        }

        .floating-fruit:nth-child(5) {
            top: 50%;
            left: 50%;
            animation-delay: 8s;
        }

        .welcome-title {
            font-size: 80px;
            color: white;
            margin-bottom: 10px;
            text-shadow: 0 10px 30px rgba(0,0,0,0.3);
            animation: bounceIn 1s ease-out;
        }

        .welcome-subtitle {
            font-size: 32px;
            color: white;
            margin-bottom: 20px;
            opacity: 0.95;
            animation: fadeInUp 1s ease-out 0.3s backwards;
        }

        .welcome-description {
            font-size: 18px;
            color: white;
            opacity: 0.85;
            margin-bottom: 50px;
            animation: fadeInUp 1s ease-out 0.5s backwards;
        }

        .start-btn {
            background: white;
            color: #667eea;
            border: none;
            padding: 18px 50px;
            border-radius: 50px;
            font-size: 20px;
            font-weight: bold;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 15px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            transition: all 0.3s ease;
            animation: fadeInUp 1s ease-out 0.7s backwards;
        }

        .start-btn:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 50px rgba(0,0,0,0.3);
        }

        .btn-arrow {
            font-size: 24px;
            transition: transform 0.3s ease;
        }

        .start-btn:hover .btn-arrow {
            transform: translateX(5px);
        }

        .welcome-footer {
            margin-top: 30px;
            color: white;
            font-size: 16px;
            opacity: 0.9;
            animation: fadeIn 1s ease-out 1s backwards;
        }

        .welcome-footer a {
            color: white;
            font-weight: bold;
            text-decoration: underline;
            cursor: pointer;
        }

       
        #signup-screen,
        #login-screen {
            min-height: 100vh;
            background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .auth-container {
            max-width: 500px;
            width: 100%;
        }

        .back-auth-btn {
            background: rgba(255, 255, 255, 0.9);
            border: none;
            color: #333;
            padding: 12px 24px;
            border-radius: 25px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            margin-bottom: 20px;
            transition: all 0.3s ease;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        }

        .back-auth-btn:hover {
            transform: translateX(-5px);
        }

        .auth-content {
            background: white;
            border-radius: 30px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.2);
            animation: slideUp 0.5s ease-out;
        }

        .auth-title {
            font-size: 32px;
            color: #333;
            margin-bottom: 10px;
            text-align: center;
        }

        .auth-subtitle {
            font-size: 16px;
            color: #666;
            margin-bottom: 30px;
            text-align: center;
        }

        .auth-form {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .form-label {
            font-size: 14px;
            font-weight: 600;
            color: #333;
        }

        .form-input {
            padding: 14px 18px;
            border: 2px solid #eee;
            border-radius: 15px;
            font-size: 15px;
            transition: all 0.3s ease;
            font-family: inherit;
            outline: none;
        }

        .form-input:focus {
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        textarea.form-input {
            resize: vertical;
            min-height: 80px;
        }

        .checkbox-group {
            flex-direction: row;
            align-items: center;
        }

        .checkbox-label {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 14px;
            color: #666;
            cursor: pointer;
        }

        .checkbox-label input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        .checkbox-label a {
            color: #667eea;
            text-decoration: underline;
        }

        .auth-submit-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 16px 40px;
            border-radius: 25px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
            transition: all 0.3s ease;
            margin-top: 10px;
        }

        .auth-submit-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 30px rgba(102, 126, 234, 0.5);
        }

        .auth-switch {
            text-align: center;
            margin-top: 20px;
            color: #666;
            font-size: 15px;
        }

        .auth-switch a {
            color: #667eea;
            font-weight: bold;
            text-decoration: none;
            cursor: pointer;
        }

        .auth-switch a:hover {
            text-decoration: underline;
        }

      
        #fruit-selection {
            min-height: 100vh;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            position: relative;
            overflow: hidden;
        }

        #fruit-selection::before {
            content: '';
            position: absolute;
            width: 300px;
            height: 300px;
            background: rgba(255,255,255,0.1);
            border-radius: 50%;
            top: -100px;
            right: -100px;
            animation: float 6s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-20px); }
        }

        .fruit-container {
            max-width: 600px;
            width: 100%;
            position: relative;
            z-index: 1;
        }

        .title {
            text-align: center;
            color: white;
            margin-bottom: 30px;
            animation: fadeInUp 0.8s ease-out;
        }

        .title h1 {
            font-size: 60px;
            margin-bottom: 10px;
            text-shadow: 0 5px 20px rgba(0,0,0,0.3);
        }

        .title p {
            font-size: 24px;
            opacity: 0.9;
            font-weight: 300;
        }

        .fruit-subtitle {
            text-align: center;
            color: white;
            font-size: 18px;
            margin-bottom: 30px;
            opacity: 0.8;
            animation: fadeIn 1s ease-out 0.3s backwards;
        }

        .fruit-options {
            display: grid;
            gap: 20px;
        }

        /* REMPLACER la section .fruit-card par : */

.fruit-card {
    background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
    padding: 30px;
    border-radius: 25px;
    cursor: pointer;
    transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    box-shadow: 0 10px 30px rgba(0,0,0,0.2);
    position: relative;
    overflow: hidden;
    animation: slideUp 0.6s ease-out backwards;
}

.fruit-card::before {
    content: '';
    position: absolute;
    top: -50%;
    right: -50%;
    width: 200%;
    height: 200%;
    background: linear-gradient(45deg, transparent 30%, rgba(255,255,255,0.1) 50%, transparent 70%);
    transform: rotate(45deg);
    transition: all 0.5s;
}

.fruit-card:hover::before {
    animation: shimmer 1.5s infinite;
}

@keyframes shimmer {
    0% { transform: translateX(-100%) rotate(45deg); }
    100% { transform: translateX(100%) rotate(45deg); }
}

.fruit-card:nth-child(1) { 
    animation-delay: 0.1s;
    background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
}
.fruit-card:nth-child(2) { 
    animation-delay: 0.2s;
    background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
}
.fruit-card:nth-child(3) { 
    animation-delay: 0.3s;
    background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
}
.fruit-card:nth-child(4) { 
    animation-delay: 0.4s;
    background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%);
}
.fruit-card:nth-child(5) { 
    animation-delay: 0.5s;
    background: linear-gradient(135deg, #fbc2eb 0%, #a6c1ee 100%);
}

        .fruit-card:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 20px 50px rgba(0,0,0,0.3);
        }

        .fruit-card-inner {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .fruit-emoji {
            font-size: 60px;
            flex-shrink: 0;
        }

        .fruit-info {
            flex: 1;
            text-align: left;
        }

        .fruit-name {
            font-size: 28px;
            font-weight: bold;
            color: white;
            margin-bottom: 8px;
            text-shadow: 0 2px 10px rgba(0,0,0,0.2);
        }

        .fruit-desc {
            font-size: 15px;
            color: rgba(255,255,255,0.95);
            line-height: 1.4;
        }

       
        .notification {
            position: fixed;
            top: 30px;
            right: 30px;
            background: white;
            padding: 20px 30px;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
            display: flex;
            align-items: center;
            gap: 15px;
            z-index: 1000;
            animation: slideInNotif 0.3s ease-out;
            cursor: pointer;
        }

        @keyframes slideInNotif {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .notification-emoji {
            font-size: 40px;
        }

        .notification-message {
            font-size: 16px;
            color: #333;
        }

        .notification.match {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
        }

        .notification.match .notification-message {
            color: white;
        }

    
     /* REMPLACER la section #swipe-screen par : */

/* REMPLACER #swipe-screen par : */

#swipe-screen {
    min-height: 100vh;
    background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 30%, #ffecd2 60%, #fcb69f 100%);
    padding: 20px;
    padding-top: 80px;
    position: relative;
    overflow: hidden;
}

#swipe-screen::before {
    content: '';
    position: absolute;
    width: 800px;
    height: 800px;
    background: radial-gradient(circle, rgba(255,255,255,0.3) 0%, rgba(255,255,255,0.1) 30%, transparent 70%);
    border-radius: 50%;
    top: -300px;
    left: 50%;
    transform: translateX(-50%);
    animation: float 12s ease-in-out infinite;
}

#swipe-screen::after {
    content: '';
    position: absolute;
    width: 600px;
    height: 600px;
    background: radial-gradient(circle, rgba(252, 182, 159, 0.2) 0%, transparent 60%);
    border-radius: 50%;
    bottom: -200px;
    right: -150px;
    animation: float 15s ease-in-out infinite reverse;
}

        .swipe-container {
            max-width: 450px;
            margin: 0 auto;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .header {
            text-align: center;
        }

        .header h2 {
            font-size: 36px;
            color: #333;
        }

        .card-stack {
            position: relative;
            width: 100%;
            height: 600px;
            touch-action: none;
        }

        /* REMPLACER .profile-card par : */

.profile-card {
    position: absolute;
    width: 100%;
    height: 100%;
    background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
    border-radius: 30px;
    overflow: hidden;
    box-shadow: 0 20px 60px rgba(0,0,0,0.25), 0 0 0 1px rgba(255,255,255,0.5) inset;
    transition: transform 0.3s ease;
    cursor: grab;
    user-select: none;
}

.profile-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 70%;
    background: linear-gradient(180deg, transparent 0%, rgba(0,0,0,0.05) 100%);
    pointer-events: none;
    z-index: 1;
}

        .profile-card:active {
            cursor: grabbing;
        }

        .profile-card.dragging {
            transition: none;
        }

        .profile-card.swipe-left {
            animation: swipeLeft 0.3s ease-out forwards;
        }

        .profile-card.swipe-right {
            animation: swipeRight 0.3s ease-out forwards;
        }

        .profile-card.coup-coeur {
            animation: coupCoeur 0.5s ease-out forwards;
        }

        @keyframes swipeLeft {
            to {
                transform: translateX(-150%) rotate(-30deg);
                opacity: 0;
            }
        }

        @keyframes swipeRight {
            to {
                transform: translateX(150%) rotate(30deg);
                opacity: 0;
            }
        }

        @keyframes coupCoeur {
            0% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.1);
            }
            100% {
                transform: scale(0) rotate(360deg);
                opacity: 0;
            }
        }

        /* REMPLACER .profile-image par : */

.profile-image {
    width: 100%;
    height: 70%;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 100px;
    position: relative;
    overflow: hidden;
}

.profile-image::before {
    content: '';
    position: absolute;
    top: -50%;
    left: -50%;
    width: 200%;
    height: 200%;
    background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 50%);
    animation: rotate 20s linear infinite;
}

.profile-image img {
    position: relative;
    z-index: 2;
}

        .profile-info {
            padding: 25px;
        }

        .profile-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .profile-name {
            font-size: 28px;
            font-weight: bold;
            color: #333;
        }

        .profile-age {
            font-size: 24px;
            color: #666;
        }

        .profile-bio {
            font-size: 16px;
            color: #666;
            margin-bottom: 15px;
        }

        .profile-tags {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .tag {
            background: #f0f0f0;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 14px;
            color: #666;
        }

        .alt-tag {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            font-weight: bold;
        }

        .action-buttons {
            display: flex;
            justify-content: center;
            gap: 30px;
        }

        /* REMPLACER .action-btn par : */

.action-btn {
    width: 70px;
    height: 70px;
    border-radius: 50%;
    border: none;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 32px;
    transition: all 0.3s ease;
    box-shadow: 0 8px 25px rgba(0,0,0,0.2), 0 0 0 4px rgba(255,255,255,0.3);
    position: relative;
    overflow: hidden;
}

.action-btn::before {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    width: 0;
    height: 0;
    border-radius: 50%;
    background: rgba(255,255,255,0.3);
    transform: translate(-50%, -50%);
    transition: width 0.6s, height 0.6s;
}
.action-btn:hover::before {
    width: 100%;
    height: 100%;
}

        .action-btn:hover {
            transform: scale(1.1);
        }

        .action-btn:active {
            transform: scale(0.95);
        }

        .btn-dislike {
    background: linear-gradient(135deg, #ff6b6b 0%, #ee5a6f 50%, #ff4757 100%);
}

.btn-coeur {
    background: linear-gradient(135deg, #ffd93d 0%, #ffb700 30%, #ff6b6b 70%, #ee5a6f 100%);
    width: 80px;
    height: 80px;
    box-shadow: 0 10px 35px rgba(255, 107, 107, 0.4), 0 0 0 5px rgba(255,255,255,0.4);
}

.btn-coeur:hover {
    box-shadow: 0 15px 45px rgba(255, 107, 107, 0.5), 0 0 0 7px rgba(255,255,255,0.5);
    animation: pulse 0.6s infinite;
}

@keyframes pulse {
    0%, 100% { transform: scale(1.15); }
    50% { transform: scale(1.2); }
}

.btn-like {
    background: linear-gradient(135deg, #6bcf7f 0%, #4facfe 50%, #00d2ff 100%);
}

      
      .top-nav {
    position: fixed;
    top: -22px; 
    left: 0;
    right: 0;
    background: white;
    box-shadow: 0 2px 20px rgba(0,0,0,0.1);
    display: flex;
    justify-content: space-around;
    padding: 15px 20px;
    z-index: 100;
}

        .nav-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
            cursor: pointer;
            transition: transform 0.2s ease;
            padding: 10px 20px;
            border-radius: 15px;
            position: relative;
        }

        .nav-btn:hover {
            transform: scale(1.05);
            background: #f8f9fa;
        }

        .nav-emoji {
            font-size: 28px;
        }

        .nav-label {
            font-size: 12px;
            font-weight: 600;
            color: #666;
        }

        .nav-badge {
            position: absolute;
            top: 5px;
            right: 10px;
            background: #ff6b6b;
            color: white;
            min-width: 20px;
            height: 20px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 11px;
            font-weight: bold;
            padding: 0 6px;
        }

      
        #messages-screen {
            min-height: 100vh;
            background: #f8f9fa;
            padding-top: 70px;
        }

        .messages-wrapper {
            max-width: 1200px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: 380px 1fr;
            gap: 0;
            height: calc(100vh - 70px);
            background: white;
            box-shadow: 0 0 40px rgba(0,0,0,0.1);
        }

        @media (max-width: 768px) {
            .messages-wrapper {
                grid-template-columns: 1fr;
            }
            
            .conversations-panel.mobile-hidden {
                display: none;
            }
            
            .chat-panel.mobile-hidden {
                display: none;
            }
        }

        .conversations-panel {
            border-right: 1px solid #eee;
            display: flex;
            flex-direction: column;
            background: white;
        }

        .conversations-header {
            padding: 25px 20px;
            border-bottom: 1px solid #eee;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .conversations-header h2 {
            font-size: 24px;
            margin-bottom: 15px;
        }

        .conversations-list {
            flex: 1;
            overflow-y: auto;
        }

        .conversation-item {
            padding: 18px 20px;
            border-bottom: 1px solid #f0f0f0;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 15px;
            position: relative;
        }

        .conversation-item:hover {
            background: #f8f9fa;
        }

        .conversation-item.active {
            background: linear-gradient(90deg, #f8f9fa 0%, #fff 100%);
            border-left: 4px solid #667eea;
        }

        .conversation-avatar {
            width: 55px;
            height: 55px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
            flex-shrink: 0;
        }

        .conversation-info {
            flex: 1;
            min-width: 0;
        }

        .conversation-name {
            font-size: 16px;
            font-weight: 600;
            color: #333;
            margin-bottom: 5px;
        }

        .conversation-preview {
            font-size: 14px;
            color: #666;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .unread-count {
            position: absolute;
            top: 18px;
            right: 20px;
            background: #ff6b6b;
            color: white;
            min-width: 22px;
            height: 22px;
            border-radius: 11px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: bold;
            padding: 0 7px;
        }

        .chat-panel {
            display: flex;
            flex-direction: column;
            background: white;
        }

        .chat-header {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            padding: 20px 25px;
            color: white;
            display: flex;
            align-items: center;
            gap: 15px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .back-btn-mobile {
            display: none;
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            font-size: 24px;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
        }

        @media (max-width: 768px) {
            .back-btn-mobile {
                display: flex;
                align-items: center;
                justify-content: center;
            }
        }

        .chat-avatar {
            font-size: 40px;
            width: 50px;
            height: 50px;
            background: rgba(255,255,255,0.2);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .chat-user-info {
            flex: 1;
        }

        .chat-user-name {
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 3px;
        }

        .chat-user-status {
            font-size: 13px;
            opacity: 0.9;
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 25px;
            background: #f8f9fa;
        }

        .empty-state {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            color: #999;
            text-align: center;
        }

        .empty-emoji {
            font-size: 80px;
            margin-bottom: 20px;
            opacity: 0.5;
        }

        .message {
            margin-bottom: 20px;
            display: flex;
            gap: 12px;
            animation: fadeInMsg 0.3s ease-out;
        }

        @keyframes fadeInMsg {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .message.sent {
            flex-direction: row-reverse;
        }

        .message-avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            flex-shrink: 0;
        }

        .message-content {
            max-width: 70%;
        }

        .message-bubble {
            padding: 14px 18px;
            border-radius: 20px;
            word-wrap: break-word;
            line-height: 1.5;
        }

        .message.received .message-bubble {
            background: white;
            color: #333;
            border-bottom-left-radius: 6px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }

        .message.sent .message-bubble {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-bottom-right-radius: 6px;
        }

        .message-time {
            font-size: 11px;
            color: #999;
            margin-top: 5px;
            padding: 0 5px;
        }

        .message.sent .message-time {
            text-align: right;
        }

        .chat-input-container {
            padding: 20px 25px;
            background: white;
            border-top: 1px solid #eee;
            display: flex;
            gap: 12px;
            align-items: flex-end;
        }

        .chat-input {
            flex: 1;
            padding: 14px 20px;
            border: 2px solid #eee;
            border-radius: 25px;
            font-size: 15px;
            outline: none;
            transition: border-color 0.3s ease;
            resize: none;
            max-height: 120px;
            font-family: inherit;
        }

        .chat-input:focus {
            border-color: #667eea;
        }

        .send-btn {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            border: none;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            font-size: 22px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }

        .send-btn:hover {
            transform: scale(1.1);
        }

        .send-btn:active {
            transform: scale(0.95);
        }

       
        #settings-screen {
            min-height: 100vh;
            background: #f8f9fa;
            padding: 80px 20px 40px;
        }

        .settings-container {
            max-width: 600px;
            margin: 0 auto;
        }

        .settings-title {
            font-size: 32px;
            color: #333;
            margin-bottom: 30px;
            text-align: center;
        }

        .settings-section {
            margin-bottom: 30px;
        }

        .section-title {
            font-size: 14px;
            font-weight: 700;
            color: #999;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 12px;
            padding: 0 5px;
        }

        .settings-card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            transition: all 0.3s ease;
        }

        .settings-card.clickable {
            cursor: pointer;
        }

        .settings-card.clickable:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        }

        .user-info-display {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .user-initial {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            font-weight: bold;
        }

        .user-name-display {
            font-size: 18px;
            font-weight: 600;
            color: #333;
            margin-bottom: 4px;
        }

        .user-email-display {
            font-size: 14px;
            color: #666;
        }

        .setting-item {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .setting-icon {
            font-size: 28px;
            width: 45px;
            height: 45px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #f8f9fa;
            border-radius: 12px;
            flex-shrink: 0;
        }

        .setting-info {
            flex: 1;
        }

        .setting-label {
            font-size: 16px;
            font-weight: 600;
            color: #333;
            margin-bottom: 3px;
        }

        .setting-value {
            font-size: 14px;
            color: #666;
        }

        .setting-arrow {
            font-size: 20px;
            color: #ccc;
        }

        .setting-toggle {
            margin-left: auto;
        }

        
        .switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 28px;
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: 0.3s;
            border-radius: 28px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 20px;
            width: 20px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: 0.3s;
            border-radius: 50%;
        }

        input:checked + .slider {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        input:checked + .slider:before {
            transform: translateX(22px);
        }

        .logout-btn {
            width: 100%;
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a6f 100%);
            color: white;
            border: none;
            padding: 18px;
            border-radius: 15px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            box-shadow: 0 5px 20px rgba(255, 107, 107, 0.3);
            transition: all 0.3s ease;
            margin-top: 30px;
        }

        .logout-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 30px rgba(255, 107, 107, 0.4);
        }

        .logout-btn:active {
            transform: translateY(-1px);
        }

        
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            animation: fadeIn 0.3s ease-out;
        }

        .modal-content {
            background: white;
            border-radius: 25px;
            padding: 30px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            animation: slideUp 0.3s ease-out;
        }

        .modal-header {
            text-align: center;
            margin-bottom: 25px;
        }

        .modal-title {
            font-size: 28px;
            color: #333;
            margin-bottom: 10px;
        }

        .modal-subtitle {
            font-size: 16px;
            color: #666;
        }

        .modal-fruit-options {
            display: grid;
            gap: 12px;
        }

        .modal-fruit-card {
            background: #f8f9fa;
            padding: 18px;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 15px;
            border: 2px solid transparent;
        }

        .modal-fruit-card:hover {
            background: #f0f0f0;
            transform: translateX(5px);
        }

        .modal-fruit-card.selected {
            background: linear-gradient(135deg, #667eea15 0%, #764ba215 100%);
            border-color: #667eea;
        }

        .modal-fruit-emoji {
            font-size: 40px;
        }

        .modal-fruit-info {
            flex: 1;
        }

        .modal-fruit-name {
            font-size: 18px;
            font-weight: 600;
            color: #333;
            margin-bottom: 4px;
        }

        .modal-fruit-desc {
            font-size: 14px;
            color: #666;
        }

        .modal-actions {
            display: flex;
            gap: 12px;
            margin-top: 25px;
        }

        .modal-btn {
            flex: 1;
            padding: 14px;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .modal-btn-cancel {
            background: #f0f0f0;
            color: #666;
        }

        .modal-btn-cancel:hover {
            background: #e0e0e0;
        }

        .modal-btn-confirm {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .modal-btn-confirm:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }

        /* Th√®mes */
        /* REMPLACER la section body.dark-theme par : */

/* REMPLACER tout le dark theme par : */

body.dark-theme {
    background: linear-gradient(135deg, #0a0e27 0%, #16213e 50%, #1a1a2e 100%);
}

body.dark-theme #swipe-screen {
    background: linear-gradient(135deg, #1a1a2e 0%, #16213e 30%, #0f3460 60%, #0a0e27 100%);
}

body.dark-theme #swipe-screen::before {
    background: radial-gradient(circle, rgba(102, 126, 234, 0.15) 0%, rgba(118, 75, 162, 0.1) 30%, transparent 70%);
}

body.dark-theme #swipe-screen::after {
    background: radial-gradient(circle, rgba(240, 147, 251, 0.1) 0%, transparent 60%);
}

body.dark-theme .profile-card {
    background: linear-gradient(135deg, #2a2a3e 0%, #1f1f2e 100%);
    box-shadow: 0 20px 60px rgba(0,0,0,0.5), 0 0 0 1px rgba(102, 126, 234, 0.2) inset;
}

body.dark-theme .profile-card::before {
    background: linear-gradient(180deg, transparent 0%, rgba(0,0,0,0.3) 100%);
}

body.dark-theme .profile-image {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
}

body.dark-theme .profile-info {
    background: linear-gradient(135deg, #2a2a3e 0%, #252535 100%);
}

body.dark-theme .profile-name {
    color: #ffffff;
    text-shadow: 0 2px 10px rgba(102, 126, 234, 0.3);
}

body.dark-theme .profile-age {
    color: #b8b8d1;
}

body.dark-theme .profile-bio {
    color: #9999b8;
}

body.dark-theme .tag {
    background: rgba(102, 126, 234, 0.15);
    color: #b8b8d1;
    border: 1px solid rgba(102, 126, 234, 0.2);
}

body.dark-theme .alt-tag {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    border: none;
    box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
}

body.dark-theme .settings-container {
    color: white;
}

body.dark-theme .settings-card {
    background: linear-gradient(135deg, #2a2a3e 0%, #252535 100%);
    border: 1px solid rgba(102, 126, 234, 0.1);
    box-shadow: 0 4px 15px rgba(0,0,0,0.3);
}

body.dark-theme .settings-card:hover {
    border-color: rgba(102, 126, 234, 0.3);
    box-shadow: 0 8px 25px rgba(102, 126, 234, 0.2);
}

body.dark-theme .setting-label {
    color: #ffffff;
}

body.dark-theme .setting-value {
    color: #9999b8;
}

body.dark-theme .setting-icon {
    background: rgba(102, 126, 234, 0.15);
    border: 1px solid rgba(102, 126, 234, 0.2);
}

body.dark-theme .section-title {
    color: #667eea;
    text-shadow: 0 0 10px rgba(102, 126, 234, 0.3);
}

body.dark-theme #messages-screen {
    background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
}

body.dark-theme .messages-wrapper {
    background: #2a2a3e;
    box-shadow: 0 0 40px rgba(0,0,0,0.5);
}

body.dark-theme .conversations-panel {
    background: linear-gradient(180deg, #2a2a3e 0%, #252535 100%);
    border-right: 1px solid rgba(102, 126, 234, 0.2);
}

body.dark-theme .conversation-item {
    border-bottom: 1px solid rgba(102, 126, 234, 0.1);
}

body.dark-theme .conversation-item:hover {
    background: rgba(102, 126, 234, 0.1);
}

body.dark-theme .conversation-item.active {
    background: linear-gradient(90deg, rgba(102, 126, 234, 0.2) 0%, rgba(102, 126, 234, 0.05) 100%);
    border-left-color: #667eea;
}

body.dark-theme .conversation-name {
    color: #ffffff;
}

body.dark-theme .conversation-preview {
    color: #9999b8;
}

body.dark-theme .chat-panel {
    background: linear-gradient(180deg, #252535 0%, #1f1f2e 100%);
}

body.dark-theme .chat-messages {
    background: linear-gradient(135deg, #1f1f2e 0%, #1a1a28 100%);
}

body.dark-theme .message.received .message-bubble {
    background: linear-gradient(135deg, #2a2a3e 0%, #252535 100%);
    color: #ffffff;
    box-shadow: 0 2px 8px rgba(0,0,0,0.3);
    border: 1px solid rgba(102, 126, 234, 0.2);
}

body.dark-theme .chat-input {
    background: #2a2a3e;
    border-color: rgba(102, 126, 234, 0.2);
    color: #ffffff;
}

body.dark-theme .chat-input:focus {
    border-color: #667eea;
    box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.2);
}

body.dark-theme .chat-input-container {
    background: linear-gradient(135deg, #2a2a3e 0%, #252535 100%);
    border-top: 1px solid rgba(102, 126, 234, 0.2);
}
    
.music-player {
    position: fixed;
    bottom: 20px;
    right: 20px;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    border-radius: 20px;
    padding: 20px;
    box-shadow: 0 10px 40px rgba(0,0,0,0.3);
    width: 320px;
    z-index: 1000;
    animation: slideInMusic 0.5s ease-out;
    display: none;
}

.music-player.active {
    display: block;
}

@keyframes slideInMusic {
    from {
        transform: translateY(100px);
        opacity: 0;
    }
    to {
        transform: translateY(0);
        opacity: 1;
    }
}

.music-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 15px;
}

.music-title {
    font-size: 16px;
    font-weight: bold;
    color: white;
}

.music-close {
    background: rgba(255,255,255,0.2);
    border: none;
    color: white;
    width: 30px;
    height: 30px;
    border-radius: 50%;
    cursor: pointer;
    font-size: 18px;
    display: flex;
    align-items: center;
    justify-content: center;
}

.music-info {
    text-align: center;
    margin-bottom: 20px;
}

.music-cover {
    width: 80px;
    height: 80px;
    background: rgba(255,255,255,0.2);
    border-radius: 15px;
    margin: 0 auto 15px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 40px;
}

.music-track-name {
    font-size: 18px;
    font-weight: bold;
    color: white;
    margin-bottom: 5px;
}

.music-artist {
    font-size: 14px;
    color: rgba(255,255,255,0.8);
}

.music-progress {
    margin-bottom: 15px;
}

.progress-bar {
    width: 100%;
    height: 6px;
    background: rgba(255,255,255,0.3);
    border-radius: 3px;
    overflow: hidden;
    cursor: pointer;
    position: relative;
}

.progress-fill {
    height: 100%;
    background: white;
    border-radius: 3px;
    width: 0%;
    transition: width 0.1s linear;
}

.progress-time {
    display: flex;
    justify-content: space-between;
    margin-top: 8px;
    font-size: 12px;
    color: rgba(255,255,255,0.8);
}

.music-controls {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 15px;
}

.music-btn {
    background: rgba(255,255,255,0.2);
    border: none;
    color: white;
    width: 45px;
    height: 45px;
    border-radius: 50%;
    cursor: pointer;
    font-size: 20px;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s ease;
}

.music-btn:hover {
    background: rgba(255,255,255,0.3);
    transform: scale(1.1);
}

.music-btn.play-pause {
    width: 55px;
    height: 55px;
    font-size: 24px;
    background: white;
    color: #667eea;
}

.music-btn.play-pause:hover {
    transform: scale(1.15);
}

.volume-control {
    margin-top: 15px;
    display: flex;
    align-items: center;
    gap: 10px;
}

.volume-icon {
    color: white;
    font-size: 18px;
}

.volume-slider {
    flex: 1;
    height: 6px;
    background: rgba(255,255,255,0.3);
    border-radius: 3px;
    outline: none;
    -webkit-appearance: none;
}

.volume-slider::-webkit-slider-thumb {
    -webkit-appearance: none;
    width: 16px;
    height: 16px;
    background: white;
    border-radius: 50%;
    cursor: pointer;
}

.volume-slider::-moz-range-thumb {
    width: 16px;
    height: 16px;
    background: white;
    border-radius: 50%;
    cursor: pointer;
    border: none;
}

.playlist-toggle {
    background: rgba(255,255,255,0.2);
    border: none;
    color: white;
    padding: 10px 20px;
    border-radius: 10px;
    cursor: pointer;
    font-size: 14px;
    margin-top: 15px;
    width: 100%;
    transition: all 0.3s ease;
}

.playlist-toggle:hover {
    background: rgba(255,255,255,0.3);
}

.playlist {
    max-height: 0;
    overflow: hidden;
    transition: max-height 0.3s ease;
}

.playlist.open {
    max-height: 300px;
    overflow-y: auto;
    margin-top: 15px;
}

.playlist-item {
    background: rgba(255,255,255,0.1);
    padding: 12px;
    border-radius: 10px;
    margin-bottom: 8px;
    cursor: pointer;
    transition: all 0.3s ease;
}

.playlist-item:hover {
    background: rgba(255,255,255,0.2);
}

.playlist-item.active {
    background: rgba(255,255,255,0.3);
}

.playlist-item-name {
    font-size: 14px;
    font-weight: 600;
    color: white;
    margin-bottom: 3px;
}

.playlist-item-artist {
    font-size: 12px;
    color: rgba(255,255,255,0.7);
}

@keyframes fadeOut {
    from {
        opacity: 1;
        transform: scale(1);
    }
    to {
        opacity: 0;
        transform: scale(0.95);
    }
}

@keyframes slideOutLeft {
    from {
        opacity: 1;
        transform: translateX(0);
    }
    to {
        opacity: 0;
        transform: translateX(-100%);
    }
}

@keyframes slideInRight {
    from {
        opacity: 0;
        transform: translateX(100%);
    }
    to {
        opacity: 1;
        transform: translateX(0);
    }
}

@keyframes zoomOut {
    from {
        opacity: 1;
        transform: scale(1);
    }
    to {
        opacity: 0;
        transform: scale(1.3);
    }
}

.page-transition-out {
    animation: fadeOut 0.4s ease-out forwards;
}

.page-transition-in {
    animation: fadeInUp 0.5s ease-out forwards;
}



@media (max-width: 768px) {
  
    body {
        font-size: 14px;
    }

   
    #welcome-screen .welcome-title {
        font-size: 50px;
    }

    #welcome-screen .welcome-subtitle {
        font-size: 24px;
    }

    #welcome-screen .welcome-description {
        font-size: 16px;
        padding: 0 10px;
    }

    .start-btn {
        padding: 15px 40px;
        font-size: 18px;
    }

    .floating-fruit {
        font-size: 40px;
    }

    
    #alt-selection .title h1 {
        font-size: 45px;
    }

    #alt-selection .title p {
        font-size: 20px;
    }

    .alt-card {
        padding: 20px;
    }

    .alt-emoji {
        font-size: 50px;
    }

    .alt-name {
        font-size: 24px;
    }

    .alt-desc {
        font-size: 14px;
    }

   
    .swipe-container {
        padding: 10px;
    }

    .header h2 {
        font-size: 28px;
    }

    .card-stack {
        height: 500px;
    }

    .profile-image {
        font-size: 80px;
    }

    .profile-info {
        padding: 20px;
    }

    .profile-name {
        font-size: 24px;
    }

    .profile-age {
        font-size: 20px;
    }

    .profile-bio {
        font-size: 14px;
    }

    .action-buttons {
        gap: 20px;
    }

    .action-btn {
        width: 60px;
        height: 60px;
        font-size: 28px;
    }

    .btn-coeur {
        width: 70px;
        height: 70px;
    }

    
    .top-nav {
        padding: 10px 5px;
        top: 0;
    }

    .nav-btn {
        padding: 8px 12px;
    }

    .nav-emoji {
        font-size: 24px;
    }

    .nav-label {
        font-size: 11px;
    }

   
    #messages-screen {
        padding-top: 60px;
    }

    .messages-wrapper {
        height: calc(100vh - 60px);
    }

    .conversations-header {
        padding: 20px 15px;
    }

    .conversations-header h2 {
        font-size: 20px;
        margin-bottom: 12px;
    }

    .search-bar {
        padding: 12px;
    }

    .conversation-item {
        padding: 15px;
    }

    .conversation-avatar {
        width: 50px;
        height: 50px;
        font-size: 24px;
    }

    .conversation-name {
        font-size: 15px;
    }

    .conversation-preview {
        font-size: 13px;
    }

    .chat-header {
        padding: 15px 20px;
    }

    .chat-user-name {
        font-size: 18px;
    }

    .chat-messages {
        padding: 15px;
    }

    .message-bubble {
        padding: 12px 16px;
        font-size: 14px;
    }

    .message-content {
        max-width: 80%;
    }

    .chat-input-container {
        padding: 15px;
    }

    .chat-input {
        padding: 12px 18px;
        font-size: 14px;
    }

    .send-btn {
        width: 44px;
        height: 44px;
        font-size: 20px;
    }

    /* Notifications mobile */
    .notification {
        top: 70px;
        right: 10px;
        left: 10px;
        padding: 15px 20px;
    }

    .notification-emoji {
        font-size: 32px;
    }

    .notification-title {
        font-size: 16px;
    }

    .notification-message {
        font-size: 13px;
    }

    /* Boutons flottants mobile */
    .back-to-alt-btn {
        top: 65px;
        left: 10px;
        padding: 10px 16px;
        font-size: 13px;
    }

    .settings-btn {
        top: 65px;
        right: 10px;
        width: 45px;
        height: 45px;
        font-size: 22px;
    }

    /* Modal param√®tres mobile */
    .settings-content {
        width: 95%;
        max-height: 85vh;
    }

    .settings-header {
        padding: 20px;
    }

    .settings-header h2 {
        font-size: 20px;
    }

    .settings-body {
        padding: 20px;
        max-height: calc(85vh - 75px);
    }

    .setting-item {
        padding: 15px 0;
    }

    .setting-label {
        font-size: 15px;
    }

    /* Auth screens mobile */
    .auth-container {
        width: 100%;
        padding: 0 10px;
    }

    .auth-content {
        padding: 30px 25px;
    }

    .auth-title {
        font-size: 28px;
    }

    .auth-subtitle {
        font-size: 15px;
    }

    .form-input {
        padding: 12px 16px;
        font-size: 14px;
    }

    .auth-submit-btn {
        padding: 14px 35px;
        font-size: 16px;
    }
}

/* Tr√®s petits √©crans (< 375px) */
@media (max-width: 375px) {
    #welcome-screen .welcome-title {
        font-size: 40px;
    }

    #welcome-screen .welcome-subtitle {
        font-size: 20px;
    }

    .start-btn {
        padding: 12px 30px;
        font-size: 16px;
    }

    #alt-selection .title h1 {
        font-size: 40px;
    }

    .alt-card {
        padding: 18px;
    }

    .alt-emoji {
        font-size: 45px;
    }

    .alt-name {
        font-size: 22px;
    }

    .card-stack {
        height: 450px;
    }

    .action-buttons {
        gap: 15px;
    }

    .action-btn {
        width: 55px;
        height: 55px;
        font-size: 24px;
    }

    .btn-coeur {
        width: 65px;
        height: 65px;
    }
}

/* Landscape mobile */
@media (max-width: 768px) and (orientation: landscape) {
    #welcome-screen,
    #alt-selection {
        min-height: auto;
        padding: 40px 20px;
    }

    .card-stack {
        height: 400px;
    }

    .action-buttons {
        margin-top: 15px;
    }
}

/* Touch improvements */
@media (hover: none) and (pointer: coarse) {
    /* Am√©lioration des zones tactiles */
    .nav-btn,
    .action-btn,
    .send-btn,
    .tab,
    .conversation-item,
    .alt-card,
    .start-btn,
    .auth-submit-btn {
        min-height: 44px;
        min-width: 44px;
    }

    /* Retirer les effets hover sur tactile */
    .alt-card:hover {
        transform: none;
    }

    .nav-btn:hover {
        transform: none;
        background: transparent;
    }

    .action-btn:hover {
        transform: none;
    }

    /* Active states pour tactile */
    .alt-card:active {
        transform: scale(0.98);
        opacity: 0.9;
    }

    .action-btn:active {
        transform: scale(0.9);
    }

    .nav-btn:active {
        background: #f8f9fa;
    }
}

/* Am√©lioration du scroll mobile */
@media (max-width: 768px) {
    /* Smooth scroll */
    .conversations-list,
    .chat-messages {
        -webkit-overflow-scrolling: touch;
        scroll-behavior: smooth;
    }

    /* Masquer scrollbar sur mobile mais garder fonctionnel */
    .conversations-list::-webkit-scrollbar,
    .chat-messages::-webkit-scrollbar {
        width: 0;
        display: none;
    }
}


@supports (padding: max(0px)) {
    .top-nav {
        padding-left: max(20px, env(safe-area-inset-left));
        padding-right: max(20px, env(safe-area-inset-right));
    }

    .swipe-container {
        padding-bottom: max(20px, env(safe-area-inset-bottom));
    }

    .chat-input-container {
        padding-bottom: max(20px, env(safe-area-inset-bottom));
    }
}

@media (max-width: 768px) {
    input,
    textarea,
    select {
        font-size: 16px !important;
    }
}


@media (max-width: 768px) {
    .profile-card {
        touch-action: pan-y;
    }

    .card-stack {
        touch-action: none;
    }
}
/* CHATBOT SUPPORT */
.support-fab {
    position: fixed;
    bottom: 30px;
    right: 30px;
    width: 60px;
    height: 60px;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 30px;
    cursor: pointer;
    box-shadow: 0 10px 30px rgba(102, 126, 234, 0.4);
    transition: all 0.3s ease;
    z-index: 999;
    animation: pulse 2s infinite;
}

.support-fab:hover {
    transform: scale(1.1);
    box-shadow: 0 15px 40px rgba(102, 126, 234, 0.6);
}

@keyframes pulse {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.05); }
}

.support-chat {
    position: fixed;
    bottom: 100px;
    right: 30px;
    width: 380px;
    height: 550px;
    background: white;
    border-radius: 20px;
    box-shadow: 0 20px 60px rgba(0,0,0,0.3);
    display: none;
    flex-direction: column;
    z-index: 1000;
    animation: slideInChat 0.3s ease-out;
}

.support-chat.active {
    display: flex;
}

@keyframes slideInChat {
    from {
        opacity: 0;
        transform: translateY(20px) scale(0.95);
    }
    to {
        opacity: 1;
        transform: translateY(0) scale(1);
    }
}

.support-chat-header {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    padding: 20px;
    border-radius: 20px 20px 0 0;
    color: white;
    display: flex;
    align-items: center;
    justify-content: space-between;
}

.support-header-left {
    display: flex;
    align-items: center;
    gap: 12px;
}

.support-bot-avatar {
    width: 45px;
    height: 45px;
    background: rgba(255,255,255,0.2);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 24px;
}

.support-bot-info h3 {
    font-size: 18px;
    margin-bottom: 3px;
}

.support-bot-status {
    font-size: 12px;
    opacity: 0.9;
}

.support-close-btn {
    background: rgba(255,255,255,0.2);
    border: none;
    color: white;
    width: 32px;
    height: 32px;
    border-radius: 50%;
    cursor: pointer;
    font-size: 20px;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s ease;
}

.support-close-btn:hover {
    background: rgba(255,255,255,0.3);
    transform: rotate(90deg);
}

.support-chat-body {
    flex: 1;
    overflow-y: auto;
    padding: 20px;
    background: #f8f9fa;
}

.support-message {
    margin-bottom: 15px;
    animation: fadeInMsg 0.3s ease-out;
}

.support-message.bot {
    display: flex;
    gap: 10px;
}

.support-message-avatar {
    width: 32px;
    height: 32px;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 18px;
    flex-shrink: 0;
}

.support-message-bubble {
    padding: 12px 16px;
    border-radius: 18px;
    max-width: 80%;
    line-height: 1.5;
    font-size: 14px;
}

.support-message.bot .support-message-bubble {
    background: white;
    color: #333;
    border-bottom-left-radius: 6px;
    box-shadow: 0 2px 5px rgba(0,0,0,0.05);
}

.support-message.user {
    display: flex;
    justify-content: flex-end;
}

.support-message.user .support-message-bubble {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    border-bottom-right-radius: 6px;
}

.support-options {
    display: flex;
    flex-direction: column;
    gap: 8px;
    margin-top: 10px;
}

.support-option-btn {
    background: white;
    border: 2px solid #e0e0e0;
    padding: 12px 16px;
    border-radius: 12px;
    cursor: pointer;
    transition: all 0.3s ease;
    text-align: left;
    font-size: 14px;
    color: #333;
    display: flex;
    align-items: center;
    gap: 10px;
}

.support-option-btn:hover {
    border-color: #667eea;
    background: #f0f4ff;
    transform: translateX(5px);
}

.support-option-emoji {
    font-size: 20px;
}

.support-typing {
    display: flex;
    gap: 6px;
    padding: 12px 16px;
    background: white;
    border-radius: 18px;
    width: fit-content;
    box-shadow: 0 2px 5px rgba(0,0,0,0.05);
}

.support-typing-dot {
    width: 8px;
    height: 8px;
    background: #667eea;
    border-radius: 50%;
    animation: bounce 1.4s infinite ease-in-out;
}

.support-typing-dot:nth-child(1) { animation-delay: 0s; }
.support-typing-dot:nth-child(2) { animation-delay: 0.2s; }
.support-typing-dot:nth-child(3) { animation-delay: 0.4s; }

.support-chat-footer {
    padding: 15px 20px;
    background: white;
    border-top: 1px solid #e0e0e0;
    border-radius: 0 0 20px 20px;
}

.support-input-container {
    display: flex;
    gap: 10px;
}

.support-input {
    flex: 1;
    padding: 12px 16px;
    border: 2px solid #e0e0e0;
    border-radius: 20px;
    font-size: 14px;
    outline: none;
    transition: border-color 0.3s ease;
}

.support-input:focus {
    border-color: #667eea;
}

.support-send-btn {
    width: 40px;
    height: 40px;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    border: none;
    border-radius: 50%;
    color: white;
    font-size: 18px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s ease;
}

.support-send-btn:hover {
    transform: scale(1.1);
}

@media (max-width: 768px) {
    .support-fab {
        bottom: 20px;
        right: 20px;
        width: 55px;
        height: 55px;
        font-size: 26px;
    }
    
    .support-chat {
        bottom: 85px;
        right: 20px;
        left: 20px;
        width: auto;
        height: 500px;
    }
}
/* AJOUTER apr√®s les styles du modal */

.credit-modal {
    max-width: 800px;
}

.credit-options {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 15px;
    margin: 20px 0;
}

.credit-card {
    background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
    padding: 25px;
    border-radius: 20px;
    cursor: pointer;
    transition: all 0.3s ease;
    border: 2px solid transparent;
    text-align: center;
    position: relative;
    overflow: hidden;
}

.credit-card::before {
    content: '';
    position: absolute;
    top: -50%;
    left: -50%;
    width: 200%;
    height: 200%;
    background: linear-gradient(45deg, transparent 30%, rgba(255,255,255,0.3) 50%, transparent 70%);
    transform: rotate(45deg);
    transition: all 0.5s;
}

.credit-card:hover {
    transform: translateY(-5px);
    border-color: #667eea;
    box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3);
}

.credit-card:hover::before {
    animation: shimmer 1.5s infinite;
}

.premium-card {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    grid-column: span 2;
}

.credit-badge {
    background: rgba(255,255,255,0.2);
    padding: 5px 15px;
    border-radius: 20px;
    font-size: 12px;
    font-weight: bold;
    display: inline-block;
    margin-bottom: 10px;
}

.credit-emoji {
    font-size: 50px;
    margin-bottom: 10px;
}

.credit-title {
    font-size: 20px;
    font-weight: bold;
    margin-bottom: 10px;
}

.credit-price {
    font-size: 32px;
    font-weight: bold;
    color: #667eea;
    margin-bottom: 10px;
}

.premium-card .credit-price {
    color: white;
}

.credit-price span {
    font-size: 16px;
    opacity: 0.7;
}

.credit-desc {
    font-size: 14px;
    color: #666;
    line-height: 1.5;
}

.premium-card .credit-desc {
    color: rgba(255,255,255,0.9);
}

.credit-features {
    text-align: left;
    margin-top: 15px;
}

.credit-feature {
    padding: 8px 0;
    font-size: 14px;
    border-bottom: 1px solid rgba(255,255,255,0.2);
}

.credit-feature:last-child {
    border-bottom: none;
}

/* Styles pour l'√©diteur de profil */

.profile-editor-modal {
    max-width: 600px;
}

.profile-editor-content {
    display: flex;
    flex-direction: column;
    gap: 25px;
}

.profile-picture-section {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 15px;
    padding: 20px;
    background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
    border-radius: 20px;
}

.profile-picture-preview {
    width: 150px;
    height: 150px;
    border-radius: 50%;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    display: flex;
    align-items: center;
    justify-content: center;
    overflow: hidden;
    box-shadow: 0 10px 30px rgba(0,0,0,0.2);
}

.profile-picture-preview img {
    width: 100%;
    height: 100%;
    object-fit: cover;
}

.profile-picture-preview .user-initial {
    font-size: 60px;
    color: white;
    font-weight: bold;
}

.change-pp-btn,
.remove-pp-btn {
    padding: 12px 30px;
    border: none;
    border-radius: 25px;
    font-size: 15px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
}

.change-pp-btn {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
}

.change-pp-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4);
}

.remove-pp-btn {
    background: #f0f0f0;
    color: #666;
}

.remove-pp-btn:hover {
    background: #ff6b6b;
    color: white;
}

.bio-counter {
    text-align: right;
    font-size: 12px;
    color: #999;
    margin-top: 5px;
}

.stats-preview {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 15px;
}

.stat-item {
    background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
    padding: 20px;
    border-radius: 15px;
    text-align: center;
}

.stat-icon {
    font-size: 40px;
    margin-bottom: 10px;
}

.stat-value {
    font-size: 28px;
    font-weight: bold;
    color: #667eea;
    margin-bottom: 5px;
}

.stat-label {
    font-size: 12px;
    color: #666;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

/* Badge de cr√©dits dans la navbar */

.credits-badge {
    position: fixed;
    top: 15px;
    right: 20px;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    padding: 8px 20px;
    border-radius: 20px;
    font-size: 14px;
    font-weight: bold;
    box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
    z-index: 999;
    cursor: pointer;
    transition: all 0.3s ease;
}

.credits-badge:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4);
}

.credits-badge.premium {
    background: linear-gradient(135deg, #ffd93d 0%, #ff6b6b 100%);
}

/* Dark theme pour les nouvelles sections */

body.dark-theme .credit-card {
    background: linear-gradient(135deg, #2a2a3e 0%, #252535 100%);
    border-color: rgba(102, 126, 234, 0.2);
}

body.dark-theme .credit-card:hover {
    border-color: #667eea;
    box-shadow: 0 10px 30px rgba(102, 126, 234, 0.4);
}

body.dark-theme .credit-desc {
    color: #9999b8;
}

body.dark-theme .profile-picture-section,
body.dark-theme .stat-item {
    background: linear-gradient(135deg, #2a2a3e 0%, #252535 100%);
}

body.dark-theme .stat-label {
    color: #9999b8;
}

body.dark-theme .remove-pp-btn {
    background: rgba(255, 107, 107, 0.2);
    color: #ff6b6b;
}

body.dark-theme .bio-counter {
    color: #9999b8;
}

@media (max-width: 768px) {
    .credit-options {
        grid-template-columns: 1fr;
    }
    
    .premium-card {
        grid-column: span 1;
    }
    
    .stats-preview {
        grid-template-columns: 1fr;
    }
}
/* AJOUTER apr√®s les styles existants */

/* Blur Overlay */
.blur-overlay {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0);
    backdrop-filter: blur(0px);
    -webkit-backdrop-filter: blur(0px);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 9999;
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    pointer-events: all;
    opacity: 0;
}

.blur-overlay.active {
    background: rgba(0, 0, 0, 0.85);
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
    opacity: 1;
}

.blur-content {
    max-width: 600px;
    width: 90%;
    padding: 20px;
}

.blur-card {
    background: white;
    border-radius: 30px;
    padding: 40px 30px;
    text-align: center;
    box-shadow: 0 20px 60px rgba(0,0,0,0.3);
    transform: scale(0.9) translateY(30px);
    opacity: 0;
    transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
}

.blur-overlay.active .blur-card {
    transform: scale(1) translateY(0);
    opacity: 1;
}

.blur-emoji {
    font-size: 80px;
    margin-bottom: 20px;
    animation: bounceEmoji 0.8s cubic-bezier(0.34, 1.56, 0.64, 1);
}

@keyframes bounceEmoji {
    0% {
        transform: scale(0) rotate(-180deg);
        opacity: 0;
    }
    50% {
        transform: scale(1.2) rotate(10deg);
    }
    70% {
        transform: scale(0.9) rotate(-5deg);
    }
    100% {
        transform: scale(1) rotate(0deg);
        opacity: 1;
    }
}

.blur-title {
    font-size: 28px;
    color: #333;
    margin-bottom: 10px;
    opacity: 0;
    animation: fadeInDown 0.6s cubic-bezier(0.34, 1.56, 0.64, 1) 0.3s forwards;
}

.blur-subtitle {
    font-size: 16px;
    color: #666;
    margin-bottom: 30px;
    opacity: 0;
    animation: fadeInDown 0.6s cubic-bezier(0.34, 1.56, 0.64, 1) 0.4s forwards;
}

@keyframes fadeInDown {
    from {
        opacity: 0;
        transform: translateY(-20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.blur-options .blur-btn {
    opacity: 0;
    transform: translateX(-30px);
    animation: slideInLeft 0.5s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
}

.blur-options .blur-btn:nth-child(1) {
    animation-delay: 0.1s;
}

.blur-options .blur-btn:nth-child(2) {
    animation-delay: 0.2s;
}

.blur-options .blur-btn:nth-child(3) {
    animation-delay: 0.3s;
}

@keyframes slideInLeft {
    from {
        opacity: 0;
        transform: translateX(-30px);
    }
    to {
        opacity: 1;
        transform: translateX(0);
    }
}

.blur-options {
    display: flex;
    flex-direction: column;
    gap: 15px;
    margin-bottom: 20px;
}

.blur-btn {
    background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
    border: 2px solid transparent;
    padding: 20px;
    border-radius: 20px;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 15px;
    transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
    text-align: left;
    transform: translateY(0);
}
.blur-btn:active {
    transform: translateY(-2px) scale(0.98);
}

.blur-btn:hover {
    transform: translateY(-5px) scale(1.02);
    box-shadow: 0 15px 40px rgba(0,0,0,0.2);
}

.blur-btn.premium-btn {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
}

.blur-btn.premium-btn:hover {
    box-shadow: 0 10px 30px rgba(102, 126, 234, 0.4);
}

.blur-btn.credits-btn {
    background: linear-gradient(135deg, #ffd93d 0%, #ff6b6b 100%);
    color: white;
}

.blur-btn.free-btn {
    background: linear-gradient(135deg, #6bcf7f 0%, #4facfe 100%);
    color: white;
}

.btn-icon {
    font-size: 40px;
    flex-shrink: 0;
    animation: pulse 2s ease-in-out infinite;
}

.blur-overlay:not(.active) .blur-card {
    transform: scale(0.9) translateY(30px);
    opacity: 0;
}

.blur-overlay:not(.active) .blur-emoji {
    animation: none;
    transform: scale(0) rotate(180deg);
}

.blur-overlay:not(.active) .blur-btn {
    animation: none;
    opacity: 0;
    transform: translateX(30px);
}

.blur-btn:hover .btn-icon {
    animation: none;
    transform: scale(1.2) rotate(10deg);
    transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
}

@keyframes pulse {
    0%, 100% {
        transform: scale(1);
    }
    50% {
        transform: scale(1.05);
    }
}

.btn-content {
    flex: 1;
}

.btn-title {
    font-size: 18px;
    font-weight: bold;
    margin-bottom: 5px;
}

.btn-desc {
    font-size: 14px;
    opacity: 0.9;
}

.btn-price {
    font-size: 20px;
    font-weight: bold;
    margin-top: 5px;
}

.close-blur-btn {
    background: transparent;
    border: 2px solid #e0e0e0;
    color: #666;
    padding: 15px 30px;
    border-radius: 15px;
    cursor: pointer;
    font-size: 16px;
    font-weight: 600;
    transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
    margin-top: 10px;
}

.close-blur-btn:hover {
    background: #f8f9fa;
    border-color: #667eea;
    color: #667eea;
    transform: translateX(-5px);
}

.close-blur-btn:active {
    transform: translateX(-2px) scale(0.98);
}

/* Publicit√© Overlay */
.ad-overlay {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.95);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 10000;
    animation: fadeIn 0.3s ease-out;
}

.ad-content {
    max-width: 600px;
    width: 90%;
    background: white;
    border-radius: 20px;
    overflow: hidden;
}

.ad-header {
    background: #333;
    color: white;
    padding: 15px 20px;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.skip-ad-btn {
    background: #666;
    border: none;
    color: white;
    padding: 8px 15px;
    border-radius: 10px;
    cursor: pointer;
    font-size: 14px;
}

.skip-ad-btn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
}

.ad-video {
    padding: 60px 40px;
    text-align: center;
}

.ad-emoji {
    font-size: 100px;
    margin-bottom: 20px;
}

.ad-video h3 {
    font-size: 24px;
    margin-bottom: 10px;
    color: #333;
}

.ad-video p {
    color: #666;
    font-size: 16px;
    margin-bottom: 30px;
}

.ad-progress {
    width: 100%;
    height: 8px;
    background: #e0e0e0;
    border-radius: 4px;
    overflow: hidden;
}

.ad-progress-bar {
    height: 100%;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    width: 0%;
    transition: width 1s linear;
}

/* Shop Modal */
.shop-modal .modal-content {
    max-width: 900px;
    max-height: 90vh;
    overflow: hidden;
    display: flex;
    flex-direction: column;
}

.shop-close-btn {
    position: absolute;
    top: 20px;
    right: 20px;
    background: rgba(0,0,0,0.1);
    border: none;
    width: 40px;
    height: 40px;
    border-radius: 50%;
    font-size: 24px;
    cursor: pointer;
    transition: all 0.3s ease;
    z-index: 10;
}

.shop-close-btn:hover {
    background: rgba(0,0,0,0.2);
    transform: rotate(90deg);
}

.shop-header {
    text-align: center;
    padding: 30px 20px 20px;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
}

.shop-title {
    font-size: 32px;
    margin-bottom: 10px;
}

.shop-subtitle {
    font-size: 16px;
    opacity: 0.9;
}

.shop-tabs {
    display: flex;
    background: #f8f9fa;
    padding: 10px;
    gap: 10px;
}

.shop-tab {
    flex: 1;
    padding: 15px;
    background: white;
    border: 2px solid transparent;
    border-radius: 15px;
    font-size: 16px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
}

.shop-tab:hover {
    background: #f0f0f0;
}

.shop-tab.active {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    border-color: #667eea;
}

.shop-body {
    flex: 1;
    overflow-y: auto;
    padding: 30px;
}

/* Premium Showcase */
.premium-hero {
    text-align: center;
    padding: 30px;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    border-radius: 20px;
    color: white;
    margin-bottom: 30px;
}

.premium-badge {
    background: rgba(255,255,255,0.2);
    padding: 8px 20px;
    border-radius: 20px;
    display: inline-block;
    font-size: 14px;
    font-weight: bold;
    margin-bottom: 15px;
}

.premium-hero h3 {
    font-size: 28px;
    margin-bottom: 15px;
}

.premium-price {
    font-size: 48px;
    font-weight: bold;
}

.premium-price span {
    font-size: 20px;
    opacity: 0.8;
}

.premium-features-list {
    display: grid;
    gap: 15px;
    margin-bottom: 30px;
}

.premium-feature {
    display: flex;
    align-items: center;
    gap: 15px;
    padding: 20px;
    background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
    border-radius: 15px;
    transition: all 0.3s ease;
}

.premium-feature:hover {
    transform: translateX(5px);
    box-shadow: 0 5px 15px rgba(0,0,0,0.1);
}

.feature-icon {
    font-size: 32px;
    flex-shrink: 0;
}

.feature-info {
    flex: 1;
}

.feature-title {
    font-size: 18px;
    font-weight: bold;
    color: #333;
    margin-bottom: 5px;
}

.feature-desc {
    font-size: 14px;
    color: #666;
}

.shop-buy-btn {
    width: 100%;
    padding: 20px;
    border: none;
    border-radius: 15px;
    font-size: 20px;
    font-weight: bold;
    cursor: pointer;
    transition: all 0.3s ease;
    box-shadow: 0 5px 20px rgba(0,0,0,0.2);
}

.premium-buy-btn {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
}

.premium-buy-btn:hover {
    transform: translateY(-3px);
    box-shadow: 0 8px 30px rgba(102, 126, 234, 0.4);
}

.premium-plans {
    margin-top: 20px;
    display: flex;
    gap: 15px;
}

.plan-btn {
    flex: 1;
    padding: 20px;
    background: linear-gradient(135deg, #ffd93d 0%, #ff6b6b 100%);
    border: none;
    border-radius: 15px;
    color: white;
    cursor: pointer;
    transition: all 0.3s ease;
    position: relative;
}

.plan-btn:hover {
    transform: translateY(-3px);
    box-shadow: 0 8px 30px rgba(255, 107, 107, 0.4);
}

.plan-badge {
    position: absolute;
    top: -10px;
    right: -10px;
    background: #ff4757;
    color: white;
    padding: 5px 12px;
    border-radius: 15px;
    font-size: 12px;
    font-weight: bold;
    box-shadow: 0 3px 10px rgba(0,0,0,0.3);
}

.plan-name {
    font-size: 16px;
    font-weight: bold;
    margin-bottom: 5px;
}

.plan-price {
    font-size: 28px;
    font-weight: bold;
    margin-bottom: 5px;
}

.plan-total {
    font-size: 12px;
    opacity: 0.9;
}

/* Credits Showcase */
.credits-info {
    text-align: center;
    padding: 20px;
    background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
    border-radius: 15px;
    margin-bottom: 30px;
}

.credits-info p {
    margin: 5px 0;
    color: #666;
    font-size: 15px;
}

.credits-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 20px;
}

.credit-pack {
    background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
    padding: 30px 20px;
    border-radius: 20px;
    text-align: center;
    cursor: pointer;
    transition: all 0.3s ease;
    border: 3px solid transparent;
    position: relative;
    overflow: hidden;
}

.credit-pack::before {
    content: '';
    position: absolute;
    top: -50%;
    left: -50%;
    width: 200%;
    height: 200%;
    background: linear-gradient(45deg, transparent 30%, rgba(255,255,255,0.3) 50%, transparent 70%);
    transform: rotate(45deg);
    transition: all 0.5s;
}

.credit-pack:hover {
    transform: translateY(-10px);
    border-color: #667eea;
    box-shadow: 0 15px 40px rgba(102, 126, 234, 0.3);
}

.credit-pack:hover::before {
    animation: shimmer 1.5s infinite;
}

.credit-pack.popular {
    border-color: #ff6b6b;
    background: linear-gradient(135deg, #fff5f5 0%, #ffe5e5 100%);
}

.credit-pack.popular:hover {
    box-shadow: 0 15px 40px rgba(255, 107, 107, 0.4);
}

.credit-pack.vip {
    border-color: #ffd93d;
    background: linear-gradient(135deg, #fffbf0 0%, #fff5d9 100%);
}

.credit-pack.vip:hover {
    box-shadow: 0 15px 40px rgba(255, 217, 61, 0.4);
}

.pack-badge {
    position: absolute;
    top: 15px;
    right: -30px;
    background: #ff4757;
    color: white;
    padding: 5px 40px;
    font-size: 11px;
    font-weight: bold;
    transform: rotate(45deg);
    box-shadow: 0 3px 10px rgba(0,0,0,0.3);
}

.pack-emoji {
    font-size: 60px;
    margin-bottom: 15px;
}

.pack-name {
    font-size: 22px;
    font-weight: bold;
    color: #333;
    margin-bottom: 10px;
}

.pack-credits {
    font-size: 32px;
    font-weight: bold;
    color: #667eea;
    margin-bottom: 5px;
}

.pack-bonus {
    font-size: 14px;
    color: #ff6b6b;
    font-weight: bold;
    margin-bottom: 10px;
}

.pack-price {
    font-size: 28px;
    font-weight: bold;
    color: #333;
    margin-bottom: 5px;
}

.pack-value {
    font-size: 12px;
    color: #999;
}

/* Boosts Showcase */
.boosts-info {
    text-align: center;
    padding: 20px;
    background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
    border-radius: 15px;
    margin-bottom: 30px;
}

.boosts-info p {
    margin: 5px 0;
    color: #666;
    font-size: 15px;
}

.boosts-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
    gap: 20px;
}

.boost-pack {
    background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
    padding: 30px 20px;
    border-radius: 20px;
    text-align: center;
    cursor: pointer;
    transition: all 0.3s ease;
    border: 3px solid transparent;
    position: relative;
}

.boost-pack:hover {
    transform: translateY(-10px);
    border-color: #4facfe;
    box-shadow: 0 15px 40px rgba(79, 172, 254, 0.3);
}

.boost-pack.popular {
    border-color: #ff6b6b;
    background: linear-gradient(135deg, #fff5f5 0%, #ffe5e5 100%);
}

.boost-badge {
    position: absolute;
    top: 15px;
    right: -30px;
    background: #ff4757;
    color: white;
    padding: 5px 40px;
    font-size: 11px;
    font-weight: bold;
    transform: rotate(45deg);
    box-shadow: 0 3px 10px rgba(0,0,0,0.3);
}

.boost-emoji {
    font-size: 60px;
    margin-bottom: 15px;
}

.boost-name {
    font-size: 22px;
    font-weight: bold;
    color: #333;
    margin-bottom: 5px;
}

.boost-duration {
    font-size: 14px;
    color: #666;
    margin-bottom: 15px;
}

.boost-price {
    font-size: 28px;
    font-weight: bold;
    color: #333;
    margin-bottom: 5px;
}

.boost-value {
    font-size: 12px;
    color: #4facfe;
    font-weight: bold;
}

/* Credits Badge am√©lior√© */
.credits-badge {
    position: fixed;
    top: 70px;
    right: 20px;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    padding: 10px 20px;
    border-radius: 25px;
    font-size: 14px;
    font-weight: bold;
    box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
    z-index: 999;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    gap: 10px;
}

.credits-badge:hover {
    transform: translateY(-3px);
    box-shadow: 0 8px 25px rgba(102, 126, 234, 0.5);
}

.credits-badge.premium {
    background: linear-gradient(135deg, #ffd93d 0%, #ff6b6b 100%);
    animation: premiumGlow 2s infinite;
}

@keyframes premiumGlow {
    0%, 100% {
        box-shadow: 0 5px 20px rgba(255, 107, 107, 0.4);
    }
    50% {
        box-shadow: 0 8px 30px rgba(255, 107, 107, 0.6);
    }
}


body.dark-theme .blur-card {
    background: linear-gradient(135deg, #2a2a3e 0%, #252535 100%);
    box-shadow: 0 20px 60px rgba(0,0,0,0.6);
}

body.dark-theme .blur-title {
    color: white;
}

body.dark-theme .blur-subtitle {
    color: #9999b8;
}

body.dark-theme .close-blur-btn {
    border-color: rgba(102, 126, 234, 0.3);
    color: #9999b8;
}

body.dark-theme .close-blur-btn:hover {
    background: rgba(102, 126, 234, 0.1);
    border-color: #667eea;
    color: #667eea;
}

/* Dark Theme pour Shop */
body.dark-theme .blur-card {
    background: linear-gradient(135deg, #2a2a3e 0%, #252535 100%);
    box-shadow: 0 20px 60px rgba(0,0,0,0.6);
}

body.dark-theme .blur-title {
    color: white;
}

body.dark-theme .blur-subtitle {
    color: #9999b8;
}

body.dark-theme .close-blur-btn {
    border-color: rgba(102, 126, 234, 0.3);
    color: #9999b8;
}

body.dark-theme .close-blur-btn:hover {
    background: rgba(102, 126, 234, 0.1);
    border-color: #667eea;
    color: #667eea;
}

body.dark-theme .blur-btn {
    background: linear-gradient(135deg, #2a2a3e 0%, #252535 100%);
    border-color: rgba(102, 126, 234, 0.3);
}

body.dark-theme .blur-btn:hover {
    border-color: #667eea;
}

body.dark-theme .shop-content {
    background: #2a2a3e;
}

body.dark-theme .shop-tabs {
    background: #1f1f2e;
}

body.dark-theme .shop-tab {
    background: #2a2a3e;
    color: white;
}

body.dark-theme .shop-tab:hover {
    background: #35354e;
}

body.dark-theme .shop-body {
    background: #2a2a3e;
}

body.dark-theme .premium-feature {
    background: linear-gradient(135deg, #35354e 0%, #2a2a3e 100%);
    border: 1px solid rgba(102, 126, 234, 0.2);
}

/* Bloquer le scroll sur la s√©lection des fruits */
#fruit-selection {
    position: fixed;
    width: 100%;
    height: 100vh;
    overflow: hidden;
}

body:has(#fruit-selection:not(.hidden)) {
    overflow: hidden;
}

body.dark-theme .feature-title {
    color: white;
}

body.dark-theme .feature-desc {
    color: #9999b8;
}

body.dark-theme .credits-info,
body.dark-theme .boosts-info {
    background: linear-gradient(135deg, #35354e 0%, #2a2a3e 100%);
}

body.dark-theme .credits-info p,
body.dark-theme .boosts-info p {
    color: #9999b8;
}

body.dark-theme .credit-pack,
body.dark-theme .boost-pack {
    background: linear-gradient(135deg, #35354e 0%, #2a2a3e 100%);
    border-color: rgba(102, 126, 234, 0.3);
}

body.dark-theme .credit-pack:hover,
body.dark-theme .boost-pack:hover {
    border-color: #667eea;
}

body.dark-theme .pack-name,
body.dark-theme .boost-name,
body.dark-theme .pack-price,
body.dark-theme .boost-price {
    color: white;
}

body.dark-theme .pack-credits {
    color: #667eea;
}

body.dark-theme .pack-value,
body.dark-theme .boost-duration {
    color: #9999b8;
}

body.dark-theme .close-blur-btn {
    color: #9999b8;
}

body.dark-theme .close-blur-btn:hover {
    color: white;
}

/* Responsive */
@media (max-width: 768px) {
    .blur-card {
        padding: 30px 20px;
    }
    
    .blur-title {
        font-size: 24px;
    }
    
    .blur-subtitle {
        font-size: 14px;
    }
    
    .btn-icon {
        font-size: 32px;
    }
    
    .btn-title {
        font-size: 16px;
    }
    
    .btn-desc {
        font-size: 13px;
    }
    
    .credits-badge {
        top: 65px;
        right: 10px;
        padding: 8px 15px;
        font-size: 12px;
    }
    
    .shop-content {
        max-height: 95vh;
    }
    
    .shop-title {
        font-size: 24px;
    }
    
    .shop-subtitle {
        font-size: 14px;
    }
    
    .shop-tabs {
        flex-direction: column;
        gap: 5px;
    }
    
    .shop-tab {
        padding: 12px;
        font-size: 14px;
    }
    
    .shop-body {
        padding: 20px;
    }
    
    .premium-hero h3 {
        font-size: 22px;
    }
    
    .premium-price {
        font-size: 36px;
    }
    
    .premium-feature {
        padding: 15px;
    }
    
    .feature-title {
        font-size: 16px;
    }
    
    .feature-desc {
        font-size: 13px;
    }
    
    .credits-grid,
    .boosts-grid {
        grid-template-columns: 1fr;
    }
    
    .premium-plans {
        flex-direction: column;
    }
    
    .ad-video {
        padding: 40px 20px;
    }
    
    .ad-emoji {
        font-size: 60px;
    }
    
    .ad-video h3 {
        font-size: 20px;
    }
}

/* Animations suppl√©mentaires */
@keyframes shimmer {
    0% {
        transform: translateX(-100%) rotate(45deg);
    }
    100% {
        transform: translateX(100%) rotate(45deg);
    }
}

@keyframes bounceIn {
    0% {
        transform: scale(0);
        opacity: 0;
    }
    50% {
        transform: scale(1.1);
    }
    100% {
        transform: scale(1);
        opacity: 1;
    }
}
/* AM√âLIORER les styles du blur-overlay */

.blur-overlay {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0);
    backdrop-filter: blur(0px);
    -webkit-backdrop-filter: blur(0px);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 9999;
    transition: all 0.5s ease;
    pointer-events: all;
}

.blur-overlay.active {
    background: rgba(0, 0, 0, 0.85);
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
}

/* Ajouter un effet de blocage visuel sur le swipe screen */
#swipe-screen.blocked {
    filter: blur(10px);
    pointer-events: none;
    user-select: none;
}

.blur-overlay::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(135deg, rgba(102, 126, 234, 0.3) 0%, rgba(118, 75, 162, 0.3) 100%);
    opacity: 0;
    transition: opacity 0.5s ease;
}

.blur-overlay.active::before {
    opacity: 1;
}

/* Emp√™cher le clic en dehors de la modal */
.blur-overlay {
    cursor: not-allowed;
}

.blur-content {
    cursor: default;
}

/* Animation de shake si tentative de swipe sans cr√©dits */
@keyframes shake {
    0%, 100% { transform: translateX(0); }
    10%, 30%, 50%, 70%, 90% { transform: translateX(-10px); }
    20%, 40%, 60%, 80% { transform: translateX(10px); }
}

.profile-card.no-credits {
    animation: shake 0.5s;
}

/* Badge cr√©dits qui clignote en rouge */
.credits-badge.low-credits {
    background: linear-gradient(135deg, #ff6b6b 0%, #ee5a6f 100%);
    animation: blink 1s infinite;
}

@keyframes blink {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.6; }
}

/* Purchase History Modal */
.purchase-history-modal {
    max-width: 700px;
}

.purchase-stats {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 15px;
    margin: 20px 0;
}

.purchase-stat {
    background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
    padding: 20px;
    border-radius: 15px;
    text-align: center;
}

.purchase-stat .stat-value {
    font-size: 32px;
    font-weight: bold;
    color: #667eea;
    margin-bottom: 5px;
}

.purchase-stat .stat-label {
    font-size: 14px;
    color: #666;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.purchase-list {
    max-height: 400px;
    overflow-y: auto;
}

.purchase-item {
    display: flex;
    align-items: center;
    gap: 15px;
    padding: 15px;
    background: #f8f9fa;
    border-radius: 15px;
    margin-bottom: 10px;
    transition: all 0.3s ease;
}

.purchase-item:hover {
    background: #e9ecef;
    transform: translateX(5px);
}

.purchase-icon {
    font-size: 32px;
    width: 50px;
    height: 50px;
    background: white;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
}

.purchase-info {
    flex: 1;
}

.purchase-title {
    font-size: 16px;
    font-weight: 600;
    color: #333;
    margin-bottom: 5px;
}

.purchase-meta {
    display: flex;
    gap: 15px;
    font-size: 12px;
    color: #999;
}

.purchase-id {
    font-family: monospace;
}

.purchase-price {
    font-size: 20px;
    font-weight: bold;
    color: #667eea;
}

/* Subscription Modal */
.subscription-modal {
    max-width: 600px;
}

.subscription-card {
    background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
    padding: 30px;
    border-radius: 20px;
    position: relative;
}

.subscription-badge {
    position: absolute;
    top: 20px;
    right: 20px;
    padding: 8px 20px;
    border-radius: 20px;
    font-size: 14px;
    font-weight: bold;
}

.subscription-badge.status-active {
    background: linear-gradient(135deg, #6bcf7f 0%, #4facfe 100%);
    color: white;
}

.subscription-badge.status-cancelled {
    background: #ff6b6b;
    color: white;
}

.subscription-plan {
    display: flex;
    align-items: center;
    gap: 15px;
    margin-bottom: 25px;
}

.plan-icon {
    width: 60px;
    height: 60px;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 32px;
}

.plan-name {
    font-size: 24px;
    font-weight: bold;
    color: #333;
    margin-bottom: 5px;
}

.plan-id {
    font-size: 12px;
    color: #999;
    font-family: monospace;
}

.subscription-details {
    background: white;
    padding: 20px;
    border-radius: 15px;
    margin-bottom: 20px;
}

.detail-row {
    display: flex;
    justify-content: space-between;
    padding: 12px 0;
    border-bottom: 1px solid #f0f0f0;
}

.detail-row:last-child {
    border-bottom: none;
}

.detail-label {
    font-size: 14px;
    color: #666;
}

.detail-value {
    font-size: 14px;
    font-weight: 600;
    color: #333;
}

.detail-value.expiring-soon {
    color: #ff6b6b;
    animation: blink 1s infinite;
}

.cancel-subscription-btn {
    width: 100%;
    padding: 15px;
    background: #ff6b6b;
    color: white;
    border: none;
    border-radius: 15px;
    font-size: 16px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
}

.cancel-subscription-btn:hover {
    background: #ee5a6f;
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(255, 107, 107, 0.4);
}

/* Dark theme */
body.dark-theme .purchase-stat {
    background: linear-gradient(135deg, #2a2a3e 0%, #252535 100%);
}

body.dark-theme .purchase-stat .stat-label {
    color: #9999b8;
}

body.dark-theme .purchase-item {
    background: #2a2a3e;
}

body.dark-theme .purchase-item:hover {
    background: #35354e;
}

body.dark-theme .purchase-icon {
    background: #35354e;
}

body.dark-theme .purchase-title {
    color: white;
}

body.dark-theme .purchase-meta {
    color: #9999b8;
}

body.dark-theme .subscription-card {
    background: linear-gradient(135deg, #2a2a3e 0%, #252535 100%);
}

body.dark-theme .plan-name {
    color: white;
}

body.dark-theme .subscription-details {
    background: #35354e;
}

body.dark-theme .detail-row {
    border-bottom-color: rgba(102, 126, 234, 0.2);
}

body.dark-theme .detail-label {
    color: #9999b8;
}

body.dark-theme .detail-value {
    color: white;
}


</style>
</head>
<body>
  
    <div id="welcome-screen">
        <div class="welcome-container">
            <div class="floating-fruits">
                <span class="floating-fruit">üçì</span>
                <span class="floating-fruit">üçë</span>
                <span class="floating-fruit">üçá</span>
                <span class="floating-fruit">üçâ</span>
                <span class="floating-fruit">üçí</span>
            </div>
            
            <div>
                <h1 class="welcome-title">üçì Alt Match</h1>
                <p class="welcome-subtitle">Trouve ton vibe parfait</p>
                <p class="welcome-description">Matche avec des personnes qui partagent tes vibes ‚ú®</p>
                
                <button class="start-btn" onclick="showSignup()">
                    <span>Commencer</span>
                    <span class="btn-arrow">‚Üí</span>
                </button>
                
                <p class="welcome-footer">D√©j√† inscrit ? <a onclick="showLogin()">Se connecter</a></p>
            </div>
        </div>
    </div>

    <!-- inscrip -->
    <div id="signup-screen" class="hidden">
        <div class="auth-container">
            <button class="back-auth-btn" onclick="backToWelcome()">‚Üê Retour</button>
            
            <div class="auth-content">
                <h2 class="auth-title">‚ú® Cr√©er un compte</h2>
                <p class="auth-subtitle">Rejoins la communaut√© Alt Match</p>
                
<form class="auth-form" onsubmit="handleSignup(event)">
                    <div class="form-group">
                        <label class="form-label">üë§ Pr√©nom</label>
                        <input type="text" id="signup-firstname" class="form-input" placeholder="Ex: Alex" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">üìù Nom</label>
                        <input type="text" id="signup-lastname" class="form-input" placeholder="Ex: Martin" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">üéÇ √Çge</label>
                        <input type="number" id="signup-age" class="form-input" placeholder="18" min="18" max="99" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">üìß Email</label>
                        <input type="email" id="signup-email" class="form-input" placeholder="alex@example.com" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">üîí Mot de passe</label>
                        <input type="password" id="signup-password" class="form-input" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required minlength="6">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">‚ú® Bio (optionnel)</label>
                        <textarea id="signup-bio" class="form-input" placeholder="Parle-nous de toi..." rows="3"></textarea>
                    </div>
                    
                    <div class="form-group checkbox-group">
                        <label class="checkbox-label">
                            <input type="checkbox" required>
                            <span>J'accepte les conditions d'utilisation</span>
                        </label>
                    </div>
                    
                    <button type="submit" class="auth-submit-btn">
                        <span>S'inscrire</span>
                        <span class="btn-arrow">‚Üí</span>
                    </button>
                </form>
                
                <p class="auth-switch">D√©j√† un compte ? <a onclick="showLogin()">Se connecter</a></p>
            </div>
        </div>
    </div>

    <!-- CONNEXION -->
    <div id="login-screen" class="hidden">
        <div class="auth-container">
            <button class="back-auth-btn" onclick="backToWelcome()">‚Üê Retour</button>
            
            <div class="auth-content">
                <h2 class="auth-title">üëã Bon retour !</h2>
                <p class="auth-subtitle">Connecte-toi √† ton compte</p>
                
                <form class="auth-form" onsubmit="handleLogin(event)">
                    <div class="form-group">
                        <label class="form-label">üìß Email</label>
                        <input type="email" id="login-email" class="form-input" placeholder="alex@example.com" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">üîí Mot de passe</label>
                        <input type="password" id="login-password" class="form-input" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required>
                    </div>
                    
                    <div class="form-group checkbox-group">
                        <label class="checkbox-label">
                            <input type="checkbox" id="remember-me">
                            <span>Se souvenir de moi</span>
                        </label>
                    </div>
                    
                    <button type="submit" class="auth-submit-btn">
                        <span>Se connecter</span>
                        <span class="btn-arrow">‚Üí</span>
                    </button>
                </form>
                
                <p class="auth-switch">Pas encore inscrit ? <a onclick="showSignup()">Cr√©er un compte</a></p>
            </div>
        </div>
    </div>

    <!-- FRUITS -->
    <div id="fruit-selection" class="hidden">
        <div class="fruit-container">
            <div class="title">
                <h1>üçì Alt Match</h1>
                <p>Trouve ton vibe parfait</p>
            </div>
            
            <div class="fruit-subtitle">
                Choisis le fruit qui correspond √† ce que tu recherches
            </div>
            
            <div class="fruit-options">
                <div class="fruit-card" onclick="selectFruit('peche')">
                    <div class="fruit-card-inner">
                        <div class="fruit-emoji">üçë</div>
                        <div class="fruit-info">
                            <div class="fruit-name">P√™che</div>
                            <div class="fruit-desc">Fun et d√©contract√©, pas de prise de t√™te</div>
                        </div>
                    </div>
                </div>
                
                <div class="fruit-card" onclick="selectFruit('raisin')">
                    <div class="fruit-card-inner">
                        <div class="fruit-emoji">üçá</div>
                        <div class="fruit-info">
                            <div class="fruit-name">Raisin</div>
                            <div class="fruit-desc">Sortir, boire un verre, faire la f√™te</div>
                        </div>
                    </div>
                </div>
                
                <div class="fruit-card" onclick="selectFruit('pasteque')">
                    <div class="fruit-card-inner">
                        <div class="fruit-emoji">üçâ</div>
                        <div class="fruit-info">
                            <div class="fruit-name">Past√®que</div>
                            <div class="fruit-desc">Chill, amiti√©, sans attentes</div>
                        </div>
                    </div>
                </div>
                
                <div class="fruit-card" onclick="selectFruit('cerise')">
                    <div class="fruit-card-inner">
                        <div class="fruit-emoji">üçí</div>
                        <div class="fruit-info">
                            <div class="fruit-name">Cerise</div>
                            <div class="fruit-desc">Relation s√©rieuse, construire quelque chose</div>
                        </div>
                    </div>
                </div>
                
                <div class="fruit-card" onclick="selectFruit('fraise')">
                    <div class="fruit-card-inner">
                        <div class="fruit-emoji">üçì</div>
                        <div class="fruit-info">
                            <div class="fruit-name">Fraise</div>
                            <div class="fruit-desc">Romance, sweet & cute vibes</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    
    <div class="top-nav hidden" id="top-nav">
        <div class="nav-btn" onclick="showSwipe()">
            <span class="nav-emoji">üî•</span>
            <span class="nav-label">D√©couvrir</span>
        </div>
        <div class="nav-btn" onclick="showMessages()">
            <span class="nav-emoji">üí¨</span>
            <span class="nav-label">Messages</span>
            <span class="nav-badge hidden" id="nav-messages-badge">0</span>
        </div>
        <div class="nav-btn" onclick="showSettings()">
            <span class="nav-emoji">‚öôÔ∏è</span>
            <span class="nav-label">Param√®tres</span>
        </div>
    </div>

   
    <div id="swipe-screen" class="hidden">
        <div class="swipe-container">
            <div class="header">
                <h2 id="fruit-header">üçë P√™che</h2>
            </div>
            
            <div class="card-stack" id="card-stack">
                
            </div>
            
            <div class="action-buttons">
                <button class="action-btn btn-dislike" onclick="swipe('left')">‚úï</button>
                <button class="action-btn btn-coeur" onclick="coupDeCoeur()">‚ú®</button>
                <button class="action-btn btn-like" onclick="swipe('right')">‚ô•</button>
            </div>
        </div>
    </div>

   
    <div id="messages-screen" class="hidden">
        <div class="messages-wrapper">
         
            <div class="conversations-panel" id="conversations-panel">
                <div class="conversations-header">
                    <h2>üí¨ Messages</h2>
                </div>

                <div class="conversations-list" id="conversations-list">
                    <div class="empty-state" style="padding: 60px 20px;">
                        <div class="empty-emoji">üíî</div>
                        <div style="font-size: 16px;">Pas encore de matchs !<br>Continue de swiper üòä</div>
                    </div>
                </div>
            </div>

            
            <div class="chat-panel" id="chat-panel">
                <div class="chat-header">
                    <button class="back-btn-mobile" onclick="backToList()">‚Üê</button>
                    <div class="chat-avatar" id="chat-avatar">üí¨</div>
                    <div class="chat-user-info">
                        <div class="chat-user-name" id="chat-user-name">S√©lectionne une conversation</div>
                        <div class="chat-user-status" id="chat-user-status">Pour commencer √† discuter</div>
                    </div>
                </div>

                <div class="chat-messages" id="chat-messages">
                    <div class="empty-state">
                        <div class="empty-emoji">üí¨</div>
                        <div style="font-size: 16px;">S√©lectionne une conversation<br>pour commencer √† discuter</div>
                    </div>
                </div>

                <div class="chat-input-container">
                    <textarea class="chat-input" id="chat-input" placeholder="√âcris un message..." rows="1" oninput="autoResize(this)" onkeydown="handleKeyDown(event)"></textarea>
                    <button class="send-btn" id="send-btn" onclick="sendMessage()">‚û§</button>
                </div>
            </div>
        </div>
    </div>

   
    <div id="settings-screen" class="hidden">
        <div class="settings-container">
            <h2 class="settings-title">‚öôÔ∏è Param√®tres</h2>
            
            <div class="settings-section">
                <h3 class="section-title">üë§ Profil</h3>
                <div class="settings-card">
                    <div class="user-info-display">
                        <div class="user-initial" id="user-initial">A</div>
                        <div>
                            <div class="user-name-display" id="user-name-display">Alex Martin</div>
                            <div class="user-email-display" id="user-email-display">alex@example.com</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- AJOUTER dans la section settings apr√®s le user-info-display -->

<<div class="settings-section">
    <h3 class="section-title">üí≥ Compte & Achats</h3>
    
    <div class="settings-card clickable" onclick="showPurchaseHistory()">
        <div class="setting-item">
            <div class="setting-icon">üìú</div>
            <div class="setting-info">
                <div class="setting-label">Historique d'achats</div>
                <div class="setting-value">Voir tous vos achats</div>
            </div>
            <div class="setting-arrow">‚Üí</div>
        </div>
    </div>

    <div class="settings-card clickable" onclick="showSubscriptionInfo()">
        <div class="setting-item">
            <div class="setting-icon">‚≠ê</div>
            <div class="setting-info">
                <div class="setting-label">Mon abonnement</div>
                <div class="setting-value" id="subscription-status">Aucun abonnement actif</div>
            </div>
            <div class="setting-arrow">‚Üí</div>
        </div>
    </div>
</div>

<!-- AJOUTER dans le body, juste apr√®s la top-nav -->

<div class="credits-badge" id="credits-display" onclick="showShop('credits')">
    üî• 5 | üíé 0
</div>

            <div class="settings-section">
                <h3 class="section-title">üçì Pr√©f√©rences</h3>
                
                <div class="settings-card clickable" onclick="changeFruit()">
                    <div class="setting-item">
                        <div class="setting-icon">üçë</div>
                        <div class="setting-info">
                            <div class="setting-label">Changer de fruit</div>
                            <div class="setting-value" id="current-fruit-display">P√™che üçë</div>
                        </div>
                        <div class="setting-arrow">‚Üí</div>
                    </div>
                </div>

                <div class="settings-card clickable" onclick="changeTheme()">
                    <div class="setting-item">
                        <div class="setting-icon">üé®</div>
                        <div class="setting-info">
                            <div class="setting-label">Th√®me</div>
                            <div class="setting-value" id="current-theme-display">Color√©</div>
                        </div>
                        <div class="setting-arrow">‚Üí</div>
                    </div>
                </div>

                <div class="settings-card">
                    <div class="setting-item">
                        <div class="setting-icon">üéµ</div>
                        <div class="setting-info">
                            <div class="setting-label">Musique d'ambiance</div>
                            <div class="setting-value" id="music-status">D√©sactiv√©e</div>
                        </div>
                        <div class="setting-toggle">
                            <label class="switch">
                                <input type="checkbox" id="music-toggle" onchange="toggleMusic()">
                                <span class="slider"></span>
                            </label>
                        </div>
                    </div>
                </div>

                <div class="settings-card">
                    <div class="setting-item">
                        <div class="setting-icon">üîî</div>
                        <div class="setting-info">
                            <div class="setting-label">Notifications</div>
                            <div class="setting-value" id="notif-status">Activ√©es</div>
                        </div>
                        <div class="setting-toggle">
                            <label class="switch">
                                <input type="checkbox" id="notif-toggle" checked onchange="toggleNotifications()">
                                <span class="slider"></span>
                            </label>
                        </div>
                    </div>
                </div>
            </div>

            <div class="settings-section">
                <h3 class="section-title">‚ÑπÔ∏è Informations</h3>
                
                <div class="settings-card">
                    <div class="setting-item">
                        <div class="setting-icon">üì±</div>
                        <div class="setting-info">
                            <div class="setting-label">Version</div>
                            <div class="setting-value">1.0.0</div>
                        </div>
                    </div>
                </div>

                <div class="settings-card clickable">
                    <div class="setting-item">
                        <div class="setting-icon">üìÑ</div>
                        <div class="setting-info">
                            <div class="setting-label">Conditions d'utilisation</div>
                        </div>
                        <div class="setting-arrow">‚Üí</div>
                    </div>
                </div>

                <div class="settings-card clickable">
                    <div class="setting-item">
                        <div class="setting-icon">üîí</div>
                        <div class="setting-info">
                            <div class="setting-label">Politique de confidentialit√©</div>
                        </div>
                        <div class="setting-arrow">‚Üí</div>
                    </div>
                </div>
            </div>

            <button class="logout-btn" onclick="logout()">
                <span>üö™</span>
                <span>Se d√©connecter</span>
            </button>
        </div>
    </div>

<div class="music-player" id="music-player">
    <div class="music-header">
        <div class="music-title">üéµ Lecteur</div>
        <button class="music-close" onclick="closeMusicPlayer()">‚úï</button>
    </div>
    
    <div class="music-info">
        <div class="music-cover" id="music-cover">üéµ</div>
        <div class="music-track-name" id="track-name">S√©lectionne une musique</div>
        <div class="music-artist" id="track-artist">Alt Match Radio</div>
    </div>
    
    <div class="music-progress">
        <div class="progress-bar" id="progress-bar" onclick="seekTrack(event)">
            <div class="progress-fill" id="progress-fill"></div>
        </div>
        <div class="progress-time">
            <span id="current-time">0:00</span>
            <span id="total-time">0:00</span>
        </div>
    </div>
    
    <div class="music-controls">
        <button class="music-btn" onclick="previousTrack()">‚èÆ</button>
        <button class="music-btn play-pause" id="play-pause-btn" onclick="togglePlay()">‚ñ∂</button>
        <button class="music-btn" onclick="nextTrack()">‚è≠</button>
    </div>
    
    <div class="volume-control">
        <span class="volume-icon">üîä</span>
        <input type="range" class="volume-slider" id="volume-slider" min="0" max="100" value="70" oninput="changeVolume(this.value)">
    </div>
    
    <button class="playlist-toggle" onclick="togglePlaylist()">
        üìã Playlist <span id="playlist-count">(5)</span>
    </button>
    
    <div class="playlist" id="playlist">
       
    </div>
    
    <audio id="audio-player"></audio>
</div>
<!-- CHATBOT SUPPORT -->
<div class="support-fab" id="support-fab" onclick="toggleSupportChat()">
    ü§ñ
</div>

<div class="support-chat" id="support-chat">
    <div class="support-chat-header">
        <div class="support-header-left">
            <div class="support-bot-avatar">ü§ñ</div>
            <div class="support-bot-info">
                <h3>Assistant Support</h3>
                <div class="support-bot-status">‚óè En ligne</div>
            </div>
        </div>
        <button class="support-close-btn" onclick="toggleSupportChat()">‚úï</button>
    </div>
    
    <div class="support-chat-body" id="support-chat-body">
        <!-- Messages appara√Ætront ici -->
    </div>
    
    <div class="support-chat-footer">
        <div class="support-input-container">
            <input 
                type="text" 
                class="support-input" 
                id="support-input" 
                placeholder="√âcris ton message..."
                onkeypress="handleSupportKeyPress(event)"
            />
            <button class="support-send-btn" onclick="sendSupportMessage()">‚û§</button>
        </div>
    </div>
</div>
    <script>
      
        let selectedFruit = null;
        let profiles = [];
        let currentIndex = 0;
        let matches = [];
        let currentChat = null;
        

        let userStats = {
    profileViews: 0,
    credits: 0,
    isPremium: false,
    swipesLeft: 5,
    maxFreeSwipes: 5,
    dailySwipesUsed: 0,
    lastSwipeReset: new Date().toDateString(),
    matchesLeft: 5,
    maxFreeMatches: 5,
    profilePicture: null
};
        
        
        const fruitEmojis = {
            peche: 'üçë',
            raisin: 'üçá',
            pasteque: 'üçâ',
            cerise: 'üçí',
            fraise: 'üçì'
        };

        const fruitNames = {
            'peche': 'P√™che üçë',
            'raisin': 'Raisin üçá',
            'pasteque': 'Past√®que üçâ',
            'cerise': 'Cerise üçí',
            'fraise': 'Fraise üçì'
        };

        const profileTypes = ['egirl', 'femboy', 'tomboy', 'eboy'];
        const names = ['Alex', 'Sam', 'Jordan', 'Morgan', 'Casey', 'Riley', 'Avery', 'Quinn', 'Taylor', 'Drew'];
        
        const bios = {
            egirl: ['Gamer girl üéÆ', 'Anime lover üíú', 'Cosplay enthusiast ‚ú®', 'Streamer vibes üåü'],
            femboy: ['Soft boy energy üå∏', 'Fashion lover üíÖ', 'Vibe positif ‚òÄÔ∏è', 'Cute & confident üíñ'],
            tomboy: ['Aventuri√®re üèîÔ∏è', 'Sportive üí™', 'Chill & fun üåä', 'Outdoor lover üå≤'],
            eboy: ['Skater vibe üõπ', 'Music addict üéµ', 'Artiste dans l\'√¢me üé®', 'Alt style üñ§']
        };

        const typeEmojis = {
            egirl: 'üëæ',
            femboy: 'üå∏',
            tomboy: '‚ö°',
            eboy: 'üé∏'
        };

        const openingMessages = [
            "Hey ! T'es nouveau par ici ? üòä",
            "Salut ! J'adore ton vibe üåü",
            "Coucou ! On devrait se parler üí¨",
            "Hey there ! Tu fais quoi de beau ? ‚ú®"
        ];

        const botResponses = [
            "Ah ouais carr√©ment ! C'est cool √ßa üòä",
            "Haha j'adore ! T'as l'air sympa",
            "C'est styl√© ! On est sur la m√™me longueur d'onde",
            "Trop bien ! Content qu'on ait match√© üòÑ",
            "Ouais grave ! Tu cherches quoi sur l'app ?",
            "J'aime bien ton √©nergie ! üí´"
        ];

      
        window.addEventListener('DOMContentLoaded', () => {
          const savedSession = localStorage.getItem('altMatchSession');
if (savedSession) {
    const session = JSON.parse(savedSession);
    currentUser = session;
}
        });
// Notifier l'utilisateur de ses cr√©dits restants
if (!userStats.isPremium && userStats.swipesLeft < 3 && userStats.credits < 10) {
    setTimeout(() => {
        showNotification('‚ö†Ô∏è', `Plus que ${userStats.swipesLeft} swipes gratuits !`);
    }, 2000);
}
     
function transitionPage(hideElement, showElement, callback) {
    hideElement.classList.add('page-transition-out');
    
    setTimeout(() => {
        hideElement.classList.add('hidden');
        hideElement.classList.remove('page-transition-out');
        
        showElement.classList.remove('hidden');
        showElement.classList.add('page-transition-in');
        
        setTimeout(() => {
            showElement.classList.remove('page-transition-in');
        }, 500);
        
        if (callback) callback();
    }, 400);
}


function showSignup() {
    transitionPage(
        document.getElementById('welcome-screen'),
        document.getElementById('signup-screen')
    );
}

function showLogin() {
    const welcomeScreen = document.getElementById('welcome-screen');
    const signupScreen = document.getElementById('signup-screen');
    const loginScreen = document.getElementById('login-screen');
    
    if (!welcomeScreen.classList.contains('hidden')) {
        transitionPage(welcomeScreen, loginScreen);
    } else {
        transitionPage(signupScreen, loginScreen);
    }
}

function backToWelcome() {
    const signupScreen = document.getElementById('signup-screen');
    const loginScreen = document.getElementById('login-screen');
    const welcomeScreen = document.getElementById('welcome-screen');
    
    if (!signupScreen.classList.contains('hidden')) {
        transitionPage(signupScreen, welcomeScreen);
    } else {
        transitionPage(loginScreen, welcomeScreen);
    }
}
// INSCRIPTION
async function handleSignup(event) {
    event.preventDefault();
    
    const email = document.getElementById('signup-email').value.trim();
    const password = document.getElementById('signup-password').value;
    const firstname = document.getElementById('signup-firstname').value.trim();
    const lastname = document.getElementById('signup-lastname').value.trim();
    
    // Validations
    if (!email || !password || !firstname || !lastname) {
        showNotification('‚ùå', 'Remplis tous les champs !');
        return;
    }
    
    // Validation email
    const emailRegex = /^[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/;
    if (!emailRegex.test(email)) {
        showNotification('‚ùå', 'Format d\'email invalide');
        return;
    }
    
    if (email.length < 6) {
        showNotification('‚ùå', 'Email trop court (min. 6 caract√®res)');
        return;
    }
    
    if (password.length < 6) {
        showNotification('‚ùå', 'Mot de passe trop court (min. 6 caract√®res)');
        return;
    }
    
    console.log('üìß Tentative inscription:', email);
    
    try {
        // 1. Cr√©er le compte Auth
        const { data: authData, error: authError } = await supabase.auth.signUp({
            email: email,
            password: password
        });
        
        // IMPORTANT: V√©rifier l'erreur ET s'arr√™ter si erreur
        if (authError) {
            console.error('‚ùå Erreur Auth:', authError);
            
            if (authError.message.includes('invalid')) {
                showNotification('‚ùå', 'Email invalide ou bloqu√©. Essaie: user' + Date.now() + '@gmail.com');
            } else if (authError.message.includes('already')) {
                showNotification('‚ùå', 'Email d√©j√† utilis√©');
            } else if (authError.message.includes('security')) {
                showNotification('‚è≥', 'Attends 5 minutes avant de r√©essayer');
            } else {
                showNotification('‚ùå', authError.message);
            }
            
            return; // ‚ö†Ô∏è STOPPER ICI si erreur Auth
        }
        
        // V√©rifier qu'on a bien un utilisateur
        if (!authData || !authData.user) {
            showNotification('‚ùå', 'Erreur lors de la cr√©ation du compte');
            return;
        }
        
        console.log('‚úÖ Auth r√©ussi, ID:', authData.user.id);
        console.log('Session:', authData.session ? 'Active' : 'Pas de session');
        
        // Si pas de session (email confirmation requise)
        if (!authData.session) {
            showNotification('üìß', 'V√©rifie ton email pour confirmer ton compte !');
            setTimeout(() => {
                transitionPage(
                    document.getElementById('signup-screen'),
                    document.getElementById('login-screen')
                );
            }, 3000);
            return;
        }
        
        // 2. Attendre un peu pour que la session soit √©tablie
        await new Promise(resolve => setTimeout(resolve, 1000));
        
        // 3. Cr√©er le profil utilisateur
        console.log('üìù Cr√©ation du profil...');
        const { data: userData, error: userError } = await supabase
            .from('users')
            .insert({
                id: authData.user.id,
                email: email,
                firstname: firstname,
                lastname: lastname
            })
            .select()
            .single();
        
        if (userError) {
            console.error('‚ùå Erreur profil:', userError);
            showNotification('‚ùå', 'Compte cr√©√© mais erreur profil. R√©essaie de te connecter.');
            return;
        }
        
        console.log('‚úÖ Profil cr√©√©:', userData);
        
        currentUser = userData;
        localStorage.setItem('altMatchSession', JSON.stringify(userData));
        
        showNotification('üéâ', `Bienvenue ${firstname} !`);
        
        setTimeout(() => {
            transitionPage(
                document.getElementById('signup-screen'),
                document.getElementById('fruit-selection')
            );
        }, 1500);
        
    } catch (error) {
        console.error('üí• Erreur inscription:', error);
        showNotification('‚ùå', 'Erreur: ' + (error.message || 'R√©essaie plus tard'));
    }
}

// CONNEXION
async function handleLogin(event) {
    event.preventDefault();
    
    const email = document.getElementById('login-email').value.trim();
    const password = document.getElementById('login-password').value;
    
    if (!email || !password) {
        showNotification('‚ùå', 'Remplis tous les champs !');
        return;
    }
    
    console.log('üîê Tentative de connexion:', email);
    
    try {
        // 1. Se connecter avec Supabase Auth
        const { data: authData, error: authError } = await supabase.auth.signInWithPassword({
            email: email,
            password: password
        });
        
        if (authError) {
            console.error('‚ùå Erreur connexion:', authError);
            
            if (authError.message.includes('Invalid login credentials')) {
                showNotification('‚ùå', 'Email ou mot de passe incorrect');
            } else if (authError.message.includes('Email not confirmed')) {
                showNotification('üìß', 'Confirme ton email d\'abord !');
            } else {
                showNotification('‚ùå', authError.message);
            }
            return;
        }
        
        console.log('‚úÖ Connexion r√©ussie, ID:', authData.user.id);
        
        // 2. R√©cup√©rer les infos du profil depuis la table users
        const { data: userData, error: userError } = await supabase
            .from('users')
            .select('*')
            .eq('id', authData.user.id)
            .single();
        
        if (userError) {
            console.error('‚ùå Erreur r√©cup√©ration profil:', userError);
            
            // Si le profil n'existe pas, le cr√©er
            if (userError.code === 'PGRST116') {
                console.log('üìù Cr√©ation du profil manquant...');
                
                const { data: newUser, error: createError } = await supabase
                    .from('users')
                    .insert({
                        id: authData.user.id,
                        email: authData.user.email,
                        firstname: authData.user.email.split('@')[0],
                        lastname: 'User'
                    })
                    .select()
                    .single();
                
                if (createError) {
                    showNotification('‚ùå', 'Erreur cr√©ation profil');
                    return;
                }
                
                currentUser = newUser;
            } else {
                showNotification('‚ùå', 'Erreur de chargement du profil');
                return;
            }
        } else {
            currentUser = userData;
        }
        
        currentSession = authData.session;
        localStorage.setItem('altMatchSession', JSON.stringify(currentUser));
        
        console.log('‚úÖ Profil charg√©:', currentUser);
        
        showNotification('üëã', `Bon retour ${currentUser.firstname} !`);
        
        setTimeout(() => {
            transitionPage(
                document.getElementById('login-screen'),
                document.getElementById('fruit-selection')
            );
        }, 1500);
        
    } catch (error) {
        console.error('üí• Erreur connexion:', error);
        showNotification('‚ùå', 'Erreur: ' + (error.message || 'R√©essaie'));
    }
}



async function selectFruit(fruit) {
    selectedFruit = fruit;
    
    const fruitNames = {
        'peche': 'P√™che üçë',
        'raisin': 'Raisin üçá',
        'pasteque': 'Past√®que üçâ',
        'cerise': 'Cerise üçí',
        'fraise': 'Fraise üçì'
    };
    
    showNotification('üéâ', `Tu as s√©lectionn√© ${fruitNames[fruit]} !`);
    
    // Sauvegarder le fruit dans Supabase
    if (currentUser && currentUser.id) {
        try {
            const { error } = await supabase
                .from('users')
                .update({ selected_fruit: fruit })
                .eq('id', currentUser.id);
            
            if (error) throw error;
            
            currentUser.selected_fruit = fruit;
            localStorage.setItem('altMatchSession', JSON.stringify(currentUser));
        } catch (error) {
            console.error('Erreur sauvegarde fruit:', error);
        }
    }
    
    setTimeout(() => {
        transitionPage(
            document.getElementById('fruit-selection'),
            document.getElementById('swipe-screen'),
            () => {
                document.getElementById('top-nav').classList.remove('hidden');
                document.getElementById('fruit-header').textContent = fruitNames[fruit];
                generateProfiles();
                showProfile(0);
            }
        );
    }, 1500);
}


function generateProfiles() {
    profiles = [];
    
   
    const images = [
        'https://i.imgur.com/RF4SNNB.jpeg',
        'https://i.imgur.com/t4elAzv.jpeg',
        'https://i.imgur.com/nZNuDCI.jpeg',
        'https://i.imgur.com/Q9t5G3P.jpeg',
        'https://i.imgur.com/CPSwors.jpeg',
        
    ];
    
    for (let i = 0; i < 20; i++) {
        const type = profileTypes[Math.floor(Math.random() * profileTypes.length)];
        const name = names[Math.floor(Math.random() * names.length)];
        const age = Math.floor(Math.random() * 8) + 19;
        const bio = bios[type][Math.floor(Math.random() * bios[type].length)];
        
        profiles.push({
            id: i,
            name: name,
            age: age,
            type: type,
            bio: bio,
            emoji: typeEmojis[type],
            fruit: selectedFruit,
            messages: [],
            unreadCount: 0,
            lastMessage: null,
            image: images[i % images.length] 
        });
    }
}
// A
function showProfile(index) {
    if (index >= profiles.length) {
        document.getElementById('card-stack').innerHTML = `
            <div style="text-align: center; padding: 100px 20px; color: #999;">
                <div style="font-size: 60px; margin-bottom: 20px;">üéâ</div>
                <div style="font-size: 24px;">Plus de profils pour le moment !</div>
            </div>
        `;
        return;
    }

    const profile = profiles[index];
    const card = document.createElement('div');
    card.className = 'profile-card';
    
    const imageHTML = profile.image 
        ? `<img src="${profile.image}" alt="${profile.name}" style="width: 100%; height: 100%; object-fit: cover;">`
        : `<div style="font-size: 100px;">${profile.emoji}</div>`;
    
    card.innerHTML = `
        <div class="profile-image">${imageHTML}</div>
        <div class="profile-info">
            <div class="profile-header">
                <span class="profile-name">${profile.name}</span>
                <span class="profile-age">${profile.age}</span>
            </div>
            <div class="profile-bio">${profile.bio}</div>
            <div class="profile-tags">
                <span class="tag alt-tag">${fruitEmojis[profile.fruit]} ${profile.fruit}</span>
                <span class="tag">${profile.type}</span>
            </div>
        </div>
    `;
    
    // AJOUTER la v√©rification au drag
    let isDragging = false;
    let startX = 0;
    let currentX = 0;
    
    card.addEventListener('mousedown', (e) => {
        // V√©rifier les cr√©dits avant de permettre le drag
        if (!checkCreditsBeforeDrag()) {
            e.preventDefault();
            return;
        }
        isDragging = true;
        startX = e.pageX;
        card.classList.add('dragging');
    });
    
    card.addEventListener('touchstart', (e) => {
        // V√©rifier les cr√©dits avant de permettre le drag
        if (!checkCreditsBeforeDrag()) {
            e.preventDefault();
            return;
        }
        isDragging = true;
        startX = e.touches[0].pageX;
        card.classList.add('dragging');
    });
    
    document.addEventListener('mousemove', (e) => {
        if (!isDragging) return;
        currentX = e.pageX - startX;
        card.style.transform = `translateX(${currentX}px) rotate(${currentX * 0.1}deg)`;
    });
    
    document.addEventListener('touchmove', (e) => {
        if (!isDragging) return;
        currentX = e.touches[0].pageX - startX;
        card.style.transform = `translateX(${currentX}px) rotate(${currentX * 0.1}deg)`;
    });
    
    const endDrag = () => {
        if (!isDragging) return;
        isDragging = false;
        card.classList.remove('dragging');
        
        if (Math.abs(currentX) > 100) {
            const direction = currentX > 0 ? 'right' : 'left';
            swipe(direction);
        } else {
            card.style.transform = '';
        }
        
        currentX = 0;
    };
    
    document.addEventListener('mouseup', endDrag);
    document.addEventListener('touchend', endDrag);
    
    document.getElementById('card-stack').innerHTML = '';
    document.getElementById('card-stack').appendChild(card);
}




function swipe(direction) {
    if (currentIndex >= profiles.length) return;
    
    // V√©rifier les cr√©dits AVANT de swiper
    if (!useSwipeCredit()) {
        return; // Bloque totalement le swipe
    }
    
    const card = document.querySelector('.profile-card');
    if (!card) return;
    
    if (direction === 'right') {
        card.classList.add('swipe-right');
        createMatch(profiles[currentIndex], false);
    } else {
        card.classList.add('swipe-left');
    }
    
    // Simuler des vues de profil
    incrementProfileViews();
    
    setTimeout(() => {
        currentIndex++;
        showProfile(currentIndex);
    }, 300);
}


function coupDeCoeur() {
    if (currentIndex >= profiles.length) return;
    
    // V√©rifier les cr√©dits AVANT le coup de coeur
    if (!useSwipeCredit()) {
        return; // Bloque totalement
    }
    
    const card = document.querySelector('.profile-card');
    if (!card) return;
    
    card.classList.add('coup-coeur');
    createMatch(profiles[currentIndex], true);
    
    // Simuler des vues de profil
    incrementProfileViews();
    
    setTimeout(() => {
        currentIndex++;
        showProfile(currentIndex);
    }, 500);
}

// Cr√©er un match
function createMatch(profile, isSuperMatch) {
    // V√©rifier si on peut matcher
    if (!canMatch()) {
        return;
    }
    
    useMatchCredit();
    
    const matchData = {
        ...profile,
        isSuperMatch: isSuperMatch,
        matchTime: new Date()
    };
    
    matches.push(matchData);
    updateBadges();
    
    const notif = document.createElement('div');
    notif.className = 'notification match';
    notif.innerHTML = `
        <div class="notification-emoji">${isSuperMatch ? '‚ú®' : 'üíï'}</div>
        <div class="notification-message">${isSuperMatch ? 'SUPER MATCH !' : 'Nouveau Match !'} avec ${profile.name}</div>
    `;
    notif.onclick = () => {
        openChat(profile.id);
        document.body.removeChild(notif);
    };
    document.body.appendChild(notif);
    
    setTimeout(() => {
        if (document.body.contains(notif)) {
            document.body.removeChild(notif);
        }
    }, 4000);
    
    setTimeout(() => {
        sendBotMessage(profile.id, openingMessages[Math.floor(Math.random() * openingMessages.length)]);
    }, Math.random() * 3000 + 2000);
}

function updateBadges() {
    const totalUnread = matches.reduce((sum, m) => sum + (m.unreadCount || 0), 0);
    const badge = document.getElementById('nav-messages-badge');
    if (totalUnread > 0) {
        badge.textContent = totalUnread;
        badge.classList.remove('hidden');
    } else {
        badge.classList.add('hidden');
    }
}

// Navigation app
function showSwipe() {
    const messagesScreen = document.getElementById('messages-screen');
    const settingsScreen = document.getElementById('settings-screen');
    const swipeScreen = document.getElementById('swipe-screen');
    
    if (!messagesScreen.classList.contains('hidden')) {
        transitionPage(messagesScreen, swipeScreen);
    } else if (!settingsScreen.classList.contains('hidden')) {
        transitionPage(settingsScreen, swipeScreen);
    }
}

function showMessages() {
    const swipeScreen = document.getElementById('swipe-screen');
    const settingsScreen = document.getElementById('settings-screen');
    const messagesScreen = document.getElementById('messages-screen');
    
    if (!swipeScreen.classList.contains('hidden')) {
        transitionPage(swipeScreen, messagesScreen, () => {
            renderConversationsList();
        });
    } else if (!settingsScreen.classList.contains('hidden')) {
        transitionPage(settingsScreen, messagesScreen, () => {
            renderConversationsList();
        });
    }
}

function backToList() {
    document.getElementById('conversations-panel').classList.remove('mobile-hidden');
    document.getElementById('chat-panel').classList.add('mobile-hidden');
}

// Conversations
function renderConversationsList() {
    const list = document.getElementById('conversations-list');
    
    if (matches.length === 0) {
        list.innerHTML = `
            <div class="empty-state" style="padding: 60px 20px;">
                <div class="empty-emoji">üíî</div>
                <div style="font-size: 16px;">Pas encore de matchs !<br>Continue de swiper üòä</div>
            </div>
        `;
        return;
    }
    
    list.innerHTML = '';
    
    matches.forEach(match => {
        const item = document.createElement('div');
        item.className = 'conversation-item' + (currentChat && currentChat.id === match.id ? ' active' : '');
        
        const lastMsg = match.lastMessage || 'Nouveau match ! Dis bonjour üëã';
        
        item.innerHTML = `
            <div class="conversation-avatar">${match.emoji}</div>
            <div class="conversation-info">
                <div class="conversation-name">${match.name} ${match.isSuperMatch ? '‚ú®' : ''}</div>
                <div class="conversation-preview">${lastMsg}</div>
            </div>
            ${match.unreadCount > 0 ? `<div class="unread-count">${match.unreadCount}</div>` : ''}
        `;
        
        item.onclick = () => openChat(match.id);
        list.appendChild(item);
    });
}

function openChat(profileId) {
    const match = matches.find(m => m.id === profileId);
    if (!match) return;
    
    currentChat = match;
    match.unreadCount = 0;
    updateBadges();
    
    if (window.innerWidth <= 768) {
        document.getElementById('conversations-panel').classList.add('mobile-hidden');
        document.getElementById('chat-panel').classList.remove('mobile-hidden');
    }
    
    document.getElementById('chat-avatar').textContent = match.emoji;
    document.getElementById('chat-user-name').textContent = match.name + (match.isSuperMatch ? ' ‚ú®' : '');
    document.getElementById('chat-user-status').textContent = 'En ligne';
    
    renderMessages();
    renderConversationsList();
}

function renderMessages() {
    const container = document.getElementById('chat-messages');
    container.innerHTML = '';
    
    if (!currentChat || currentChat.messages.length === 0) {
        container.innerHTML = `
            <div class="empty-state">
                <div class="empty-emoji">üí¨</div>
                <div style="font-size: 16px;">Nouveau match !<br>Envoie le premier message üòä</div>
            </div>
        `;
        return;
    }
    
    currentChat.messages.forEach(msg => {
        const div = document.createElement('div');
        div.className = `message ${msg.sender === 'user' ? 'sent' : 'received'}`;
        
        const time = new Date(msg.time);
        const timeStr = time.getHours().toString().padStart(2, '0') + ':' + time.getMinutes().toString().padStart(2, '0');
        
        div.innerHTML = `
            <div class="message-avatar">${msg.sender === 'user' ? 'üë§' : currentChat.emoji}</div>
            <div class="message-content">
                <div class="message-bubble">${msg.text}</div>
                <div class="message-time">${timeStr}</div>
            </div>
        `;
        
        container.appendChild(div);
    });
    
    container.scrollTop = container.scrollHeight;
}

function sendMessage() {
    const input = document.getElementById('chat-input');
    const text = input.value.trim();
    
    if (!text || !currentChat) return;
    
    const message = {
        sender: 'user',
        text: text,
        time: new Date()
    };
    
    currentChat.messages.push(message);
    currentChat.lastMessage = text.substring(0, 50);
    
    input.value = '';
    input.style.height = 'auto';
    renderMessages();
    
    setTimeout(() => {
        const response = botResponses[Math.floor(Math.random() * botResponses.length)];
        sendBotMessage(currentChat.id, response);
    }, Math.random() * 2000 + 1000);
}

function sendBotMessage(profileId, text) {
    const match = matches.find(m => m.id === profileId);
    if (!match) return;
    
    const message = {
        sender: 'bot',
        text: text,
        time: new Date()
    };
    
    match.messages.push(message);
    match.lastMessage = text.substring(0, 50);
    
    if (!currentChat || currentChat.id !== profileId) {
        match.unreadCount = (match.unreadCount || 0) + 1;
        updateBadges();
    } else {
        renderMessages();
    }
    
    renderConversationsList();
}

function autoResize(textarea) {
            textarea.style.height = 'auto';
            textarea.style.height = Math.min(textarea.scrollHeight, 120) + 'px';
        }

        function handleKeyDown(event) {
            if (event.key === 'Enter' && !event.shiftKey) {
                event.preventDefault();
                sendMessage();
            }
        }

        // Notifications
        function showNotification(emoji, message) {
            const notification = document.createElement('div');
            notification.className = 'notification';
            notification.innerHTML = `
                <div class="notification-emoji">${emoji}</div>
                <div class="notification-message">${message}</div>
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                if (document.body.contains(notification)) {
                    document.body.removeChild(notification);
                }
            }, 3000);
        }
       
let appSettings = {
    theme: 'colorful',
    musicEnabled: false,
    notificationsEnabled: true
};

function loadSettings() {
    const saved = localStorage.getItem('altMatchSettings');
    if (saved) {
        appSettings = JSON.parse(saved);
        applySettings();
    }
}
function loadUserStats() {
    const saved = localStorage.getItem('altMatchStats');
    if (saved) {
        userStats = JSON.parse(saved);
        
        // Initialiser les nouvelles propri√©t√©s si elles n'existent pas
        if (!userStats.purchaseHistory) {
            userStats.purchaseHistory = [];
        }
        if (!userStats.currentSubscription) {
            userStats.currentSubscription = null;
        }
        
        // Reset daily swipes
        const today = new Date().toDateString();
        if (userStats.lastSwipeReset !== today) {
            userStats.swipesLeft = userStats.maxFreeSwipes;
            userStats.dailySwipesUsed = 0;
            userStats.lastSwipeReset = today;
            saveUserStats();
        }
    } else {
        userStats.profileViews = Math.floor(Math.random() * 50) + 10;
        userStats.purchaseHistory = [];
        userStats.currentSubscription = null;
        saveUserStats();
    }
    updateStatsDisplay();
}

function saveUserStats() {
    localStorage.setItem('altMatchStats', JSON.stringify(userStats));
}

function incrementProfileViews() {
    if (Math.random() > 0.7) { // 30% de chance d'avoir une vue
        userStats.profileViews += Math.floor(Math.random() * 3) + 1;
        saveUserStats();
    }
}


function useSwipeCredit() {
    // Premium = illimit√©
    if (userStats.isPremium) return true;
    
    // V√©rifier les swipes gratuits
    if (userStats.swipesLeft > 0) {
        userStats.swipesLeft--;
        userStats.dailySwipesUsed++;
        saveUserStats();
        updateStatsDisplay();
        
        // Alert si bient√¥t plus de swipes
        if (userStats.swipesLeft === 2) {
            setTimeout(() => {
                showNotification('‚ö†Ô∏è', 'Plus que 2 swipes gratuits !');
            }, 500);
        } else if (userStats.swipesLeft === 0) {
            setTimeout(() => {
                showNotification('üö´', 'Swipes gratuits √©puis√©s !');
            }, 500);
        }
        
        return true;
    }
    
    // V√©rifier les cr√©dits payants
    if (userStats.credits > 0) {
        userStats.credits--;
        saveUserStats();
        updateStatsDisplay();
        
        // Alert si bient√¥t plus de cr√©dits
        if (userStats.credits === 5) {
            setTimeout(() => {
                showNotification('‚ö†Ô∏è', 'Plus que 5 cr√©dits !');
            }, 500);
        }
        
        return true;
    }
    
    // Plus de cr√©dits = BLOQUER avec blur
    showBlurOverlay();
    return false;
}

function canMatch() {
    if (userStats.isPremium) return true;
    
    if (userStats.matchesLeft <= 0 && userStats.credits <= 0) {
        showBlurOverlay('match');
        return false;
    }
    
    return true;
}

function useMatchCredit() {
    if (userStats.isPremium) return;
    
    if (userStats.matchesLeft > 0) {
        userStats.matchesLeft--;
    } else if (userStats.credits > 0) {
        userStats.credits--;
    }
    
    saveUserStats();
    updateStatsDisplay();
}
/* REMPLACER la fonction showBlurOverlay par : */

function showBlurOverlay(type = 'swipe') {
    // V√©rifier qu'il n'y a pas d√©j√† un overlay
    if (document.getElementById('blur-overlay')) {
        return;
    }
    
    const overlay = document.createElement('div');
    overlay.className = 'blur-overlay';
    overlay.id = 'blur-overlay';
    
    const message = type === 'swipe' 
        ? 'üî• Tu as utilis√© tous tes swipes !'
        : 'üíï Tu as utilis√© tous tes matchs !';
    
    const nextReset = new Date();
    nextReset.setDate(nextReset.getDate() + 1);
    nextReset.setHours(0, 0, 0, 0);
    const hoursLeft = Math.floor((nextReset - new Date()) / (1000 * 60 * 60));
    
    overlay.innerHTML = `
        <div class="blur-content">
            <div class="blur-card">
                <div class="blur-emoji">üò¢</div>
                <h2 class="blur-title">${message}</h2>
                <p class="blur-subtitle">Reviens dans ${hoursLeft}h ou continue maintenant !</p>
                
                <div class="blur-options">
                    <button class="blur-btn premium-btn" onclick="showShop('premium')">
                        <span class="btn-icon">‚≠ê</span>
                        <div class="btn-content">
                            <div class="btn-title">Passer Premium</div>
                            <div class="btn-desc">Swipes & Matchs illimit√©s</div>
                            <div class="btn-price">9,99‚Ç¨/mois</div>
                        </div>
                    </button>
                    
                    <button class="blur-btn credits-btn" onclick="showShop('credits')">
                        <span class="btn-icon">üíé</span>
                        <div class="btn-content">
                            <div class="btn-title">Acheter des cr√©dits</div>
                            <div class="btn-desc">√Ä partir de 2,99‚Ç¨</div>
                        </div>
                    </button>
                    
                    <button class="blur-btn free-btn" onclick="claimFreeCredits()">
                        <span class="btn-icon">üéÅ</span>
                        <div class="btn-content">
                            <div class="btn-title">Cr√©dits gratuits</div>
                            <div class="btn-desc">Regarde une pub pour +10 swipes</div>
                        </div>
                    </button>
                </div>
                
                <button class="close-blur-btn" onclick="closeBlurOverlay()">
                    ‚Üê Retour
                </button>
            </div>
        </div>
    `;
    
    document.body.appendChild(overlay);
    

    document.body.style.overflow = 'hidden';
    
    
    const swipeScreen = document.getElementById('swipe-screen');
    if (swipeScreen) {
        swipeScreen.style.pointerEvents = 'none';
        swipeScreen.style.userSelect = 'none';
        swipeScreen.style.filter = 'blur(10px)';  
    }

    setTimeout(() => {
        overlay.classList.add('active');
    }, 10);
}


function addPurchase(type, amount, price, details) {
    const purchase = {
        id: 'PUR-' + Date.now() + '-' + Math.random().toString(36).substr(2, 9),
        type: type,
        amount: amount,
        price: price,
        details: details,
        date: new Date().toISOString(),
        status: 'completed'
    };
    
    userStats.purchaseHistory.unshift(purchase);
    saveUserStats();
    return purchase;
}

function calculateTotalSpent() {
    return userStats.purchaseHistory.reduce((total, purchase) => total + purchase.price, 0);
}


function showPurchaseHistory() {
    const modal = document.createElement('div');
    modal.className = 'modal-overlay';
    
    let historyHTML = '';
    
    if (userStats.purchaseHistory.length === 0) {
        historyHTML = `
            <div class="empty-state" style="padding: 60px 20px;">
                <div class="empty-emoji">üõí</div>
                <div style="font-size: 16px;">Aucun achat effectu√©</div>
            </div>
        `;
    } else {
        historyHTML = userStats.purchaseHistory.map(purchase => {
            const date = new Date(purchase.date);
            const dateStr = date.toLocaleDateString('fr-FR', {
                day: '2-digit',
                month: '2-digit',
                year: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
            
            let icon = 'üíé';
            if (purchase.type === 'premium') icon = '‚≠ê';
            else if (purchase.type === 'boost') icon = 'üöÄ';
            
            return `
                <div class="purchase-item">
                    <div class="purchase-icon">${icon}</div>
                    <div class="purchase-info">
                        <div class="purchase-title">${purchase.details}</div>
                        <div class="purchase-meta">
                            <span class="purchase-id">ID: ${purchase.id}</span>
                            <span class="purchase-date">${dateStr}</span>
                        </div>
                    </div>
                    <div class="purchase-price">${purchase.price.toFixed(2)}‚Ç¨</div>
                </div>
            `;
        }).join('');
    }
    
    modal.innerHTML = `
        <div class="modal-content purchase-history-modal">
            <button class="shop-close-btn" onclick="closeModal()">‚úï</button>
            
            <div class="modal-header">
                <div class="modal-title">üìú Historique d'achats</div>
                <div class="modal-subtitle">Tous vos achats sur Alt Match</div>
            </div>
            
            <div class="purchase-stats">
                <div class="purchase-stat">
                    <div class="stat-value">${userStats.purchaseHistory.length}</div>
                    <div class="stat-label">Achats</div>
                </div>
                <div class="purchase-stat">
                    <div class="stat-value">${calculateTotalSpent().toFixed(2)}‚Ç¨</div>
                    <div class="stat-label">Total d√©pens√©</div>
                </div>
            </div>
            
            <div class="purchase-list">
                ${historyHTML}
            </div>
        </div>
    `;
    
    document.body.appendChild(modal);
    modal.onclick = (e) => {
        if (e.target === modal) closeModal();
    };
}


function activateSubscription(plan, price) {
    const startDate = new Date();
    const endDate = new Date();
    
    if (plan === 'monthly') {
        endDate.setMonth(endDate.getMonth() + 1);
    } else if (plan === 'yearly') {
        endDate.setFullYear(endDate.getFullYear() + 1);
    }
    
    userStats.currentSubscription = {
        id: 'SUB-' + Date.now() + '-' + Math.random().toString(36).substr(2, 9),
        plan: plan,
        price: price,
        startDate: startDate.toISOString(),
        endDate: endDate.toISOString(),
        status: 'active',
        autoRenew: true
    };
    
    saveUserStats();
    updateSubscriptionDisplay();
}


function updateSubscriptionDisplay() {
    const subStatus = document.getElementById('subscription-status');
    if (!subStatus) return;
    
    if (userStats.currentSubscription && userStats.currentSubscription.status === 'active') {
        const planName = userStats.currentSubscription.plan === 'monthly' ? 'Mensuel' : 'Annuel';
        subStatus.textContent = `Premium ${planName} actif`;
    } else {
        subStatus.textContent = 'Aucun abonnement actif';
    }
}


function cancelSubscription() {
    if (confirm('‚ö†Ô∏è √ätes-vous s√ªr de vouloir annuler votre abonnement Premium ?\n\nVous conserverez vos avantages jusqu\'√† la fin de la p√©riode.')) {
        if (userStats.currentSubscription) {
            userStats.currentSubscription.status = 'cancelled';
            userStats.currentSubscription.autoRenew = false;
            saveUserStats();
            updateSubscriptionDisplay();
            showNotification('‚úì', 'Abonnement annul√©');
            closeModal();
        }
    }
}


function showSubscriptionInfo() {
    const modal = document.createElement('div');
    modal.className = 'modal-overlay';
    
    let subscriptionHTML = '';
    
    if (!userStats.currentSubscription || userStats.currentSubscription.status === 'cancelled') {
        subscriptionHTML = `
            <div class="empty-state" style="padding: 60px 20px;">
                <div class="empty-emoji">‚≠ê</div>
                <div style="font-size: 16px; margin-bottom: 20px;">Aucun abonnement actif</div>
                <button class="modal-btn modal-btn-confirm" onclick="closeModal(); setTimeout(() => showShop('premium'), 300);">
                    Devenir Premium
                </button>
            </div>
        `;
    } else {
        const sub = userStats.currentSubscription;
        const startDate = new Date(sub.startDate);
        const endDate = new Date(sub.endDate);
        const daysLeft = Math.ceil((endDate - new Date()) / (1000 * 60 * 60 * 24));
        
        const planName = sub.plan === 'monthly' ? 'Mensuel' : 'Annuel';
        
        subscriptionHTML = `
            <div class="subscription-card">
                <div class="subscription-badge status-active">‚úì Actif</div>
                
                <div class="subscription-plan">
                    <div class="plan-icon">‚≠ê</div>
                    <div>
                        <div class="plan-name">Premium ${planName}</div>
                        <div class="plan-id">ID: ${sub.id}</div>
                    </div>
                </div>
                
                <div class="subscription-details">
                    <div class="detail-row">
                        <span class="detail-label">üí≥ Prix</span>
                        <span class="detail-value">${sub.price.toFixed(2)}‚Ç¨/${sub.plan === 'monthly' ? 'mois' : 'an'}</span>
                    </div>
                    
                    <div class="detail-row">
                        <span class="detail-label">üìÖ D√©but</span>
                        <span class="detail-value">${startDate.toLocaleDateString('fr-FR')}</span>
                    </div>
                    
                    <div class="detail-row">
                        <span class="detail-label">‚è∞ Expire le</span>
                        <span class="detail-value">${endDate.toLocaleDateString('fr-FR')}</span>
                    </div>
                    
                    <div class="detail-row">
                        <span class="detail-label">‚è≥ Jours restants</span>
                        <span class="detail-value ${daysLeft < 7 ? 'expiring-soon' : ''}">${daysLeft} jours</span>
                    </div>
                    
                    <div class="detail-row">
                        <span class="detail-label">üîÑ Renouvellement</span>
                        <span class="detail-value">${sub.autoRenew ? 'Automatique' : 'D√©sactiv√©'}</span>
                    </div>
                </div>
                
                <button class="cancel-subscription-btn" onclick="cancelSubscription()">
                    Annuler l'abonnement
                </button>
            </div>
        `;
    }
    
    modal.innerHTML = `
        <div class="modal-content subscription-modal">
            <button class="shop-close-btn" onclick="closeModal()">‚úï</button>
            
            <div class="modal-header">
                <div class="modal-title">‚≠ê Mon abonnement</div>
                <div class="modal-subtitle">G√©rez votre abonnement Premium</div>
            </div>
            
            ${subscriptionHTML}
        </div>
    `;
    
    document.body.appendChild(modal);
    modal.onclick = (e) => {
        if (e.target === modal) closeModal();
    };
}
function closeBlurOverlay() {
    const overlay = document.getElementById('blur-overlay');
    if (!overlay) return;
    
  
    overlay.classList.remove('active');
    

    setTimeout(() => {
        if (document.body.contains(overlay)) {
            document.body.removeChild(overlay);
        }
        
        document.body.style.overflow = '';
        
      
        const swipeScreen = document.getElementById('swipe-screen');
        if (swipeScreen) {
            swipeScreen.style.pointerEvents = 'auto';
            swipeScreen.style.userSelect = 'auto';
            swipeScreen.style.filter = 'none';
            swipeScreen.classList.remove('blocked');
        }
    }, 400);
}

function checkCreditsBeforeDrag() {
    if (userStats.isPremium) return true;
    
    if (userStats.swipesLeft <= 0 && userStats.credits <= 0) {
        showBlurOverlay();
        return false;
    }
    
    return true;
}
function claimFreeCredits() {

    showNotification('üì∫', 'Chargement de la publicit√©...');
    
    setTimeout(() => {
        const adOverlay = document.createElement('div');
        adOverlay.className = 'ad-overlay';
        adOverlay.innerHTML = `
            <div class="ad-content">
                <div class="ad-header">
                    <span>Publicit√©</span>
                    <button class="skip-ad-btn" id="skip-ad-btn" disabled>Passer dans <span id="skip-timer">5</span>s</button>
                </div>
                <div class="ad-video">
                    <div class="ad-emoji">üì∫</div>
                    <h3>Publicit√© Alt Match</h3>
                    <p>Merci de regarder cette pub pour soutenir l'app !</p>
                    <div class="ad-progress">
                        <div class="ad-progress-bar" id="ad-progress-bar"></div>
                    </div>
                </div>
            </div>
        `;
        
        document.body.appendChild(adOverlay);
        
        let timeLeft = 5;
        const progressBar = document.getElementById('ad-progress-bar');
        const skipTimer = document.getElementById('skip-timer');
        const skipBtn = document.getElementById('skip-ad-btn');
        
        const interval = setInterval(() => {
            timeLeft--;
            skipTimer.textContent = timeLeft;
            progressBar.style.width = ((5 - timeLeft) / 5 * 100) + '%';
            
            if (timeLeft <= 0) {
                clearInterval(interval);
                skipBtn.textContent = 'Fermer';
                skipBtn.disabled = false;
                skipBtn.onclick = () => {
                    document.body.removeChild(adOverlay);
                    userStats.swipesLeft += 10;
                    saveUserStats();
                    updateStatsDisplay();
                    closeBlurOverlay();
                    showNotification('üéÅ', '+10 swipes gratuits !');
                };
            }
        }, 1000);
    }, 1000);
}

function showShop(tab = 'premium') {
    // Fermer le blur overlay d'abord
    closeBlurOverlay();
    
    
    setTimeout(() => {
        const modal = document.createElement('div');
        modal.className = 'modal-overlay shop-modal';
        modal.innerHTML = `
            <div class="modal-content shop-content">
                <button class="shop-close-btn" onclick="closeModal()">‚úï</button>
                
                <div class="shop-header">
                    <h2 class="shop-title">üíé Boutique Alt Match</h2>
                    <p class="shop-subtitle">Booste ton exp√©rience de dating !</p>
                </div>
                
                <div class="shop-tabs">
                    <button class="shop-tab ${tab === 'premium' ? 'active' : ''}" onclick="switchShopTab('premium')">
                        ‚≠ê Premium
                    </button>
                    <button class="shop-tab ${tab === 'credits' ? 'active' : ''}" onclick="switchShopTab('credits')">
                        üíé Cr√©dits
                    </button>
                    <button class="shop-tab ${tab === 'boosts' ? 'active' : ''}" onclick="switchShopTab('boosts')">
                        üöÄ Boosts
                    </button>
                </div>
                
                <div class="shop-body" id="shop-body">
                    ${getShopContent(tab)}
                </div>
            </div>
        `;
        
        document.body.appendChild(modal);
        modal.onclick = (e) => {
            if (e.target === modal) closeModal();
        };
    }, 300);
}

function getShopContent(tab) {
    if (tab === 'premium') {
        return `
            <div class="premium-showcase">
                <div class="premium-hero">
                    <div class="premium-badge">‚≠ê PREMIUM</div>
                    <h3>D√©bloque tout le potentiel d'Alt Match</h3>
                    <div class="premium-price">9,99‚Ç¨<span>/mois</span></div>
                </div>
                
                <div class="premium-features-list">
                    <div class="premium-feature">
                        <span class="feature-icon">üî•</span>
                        <div class="feature-info">
                            <div class="feature-title">Swipes illimit√©s</div>
                            <div class="feature-desc">Like autant de profils que tu veux</div>
                        </div>
                    </div>
                    
                    <div class="premium-feature">
                        <span class="feature-icon">üíï</span>
                        <div class="feature-info">
                            <div class="feature-title">Matchs illimit√©s</div>
                            <div class="feature-desc">Plus de limite sur tes matchs</div>
                        </div>
                    </div>
                    
                    <div class="premium-feature">
                        <span class="feature-icon">üëÄ</span>
                        <div class="feature-info">
                            <div class="feature-title">Voir qui te like</div>
                            <div class="feature-desc">D√©couvre qui a lik√© ton profil</div>
                        </div>
                    </div>
                    
                    <div class="premium-feature">
                        <span class="feature-icon">‚ú®</span>
                        <div class="feature-info">
                            <div class="feature-title">5 Super Likes/jour</div>
                            <div class="feature-desc">Montre que tu craques vraiment</div>
                        </div>
                    </div>
                    
                    <div class="premium-feature">
                        <span class="feature-icon">üöÄ</span>
                        <div class="feature-info">
                            <div class="feature-title">Boost mensuel gratuit</div>
                            <div class="feature-desc">Sois vu 10x plus chaque mois</div>
                        </div>
                    </div>
                    
                    <div class="premium-feature">
                        <span class="feature-icon">üéØ</span>
                        <div class="feature-info">
                            <div class="feature-title">Filtres avanc√©s</div>
                            <div class="feature-desc">Affine ta recherche</div>
                        </div>
                    </div>
                    
                    <div class="premium-feature">
                        <span class="feature-icon">üîî</span>
                        <div class="feature-info">
                            <div class="feature-title">Pas de publicit√©s</div>
                            <div class="feature-desc">Exp√©rience sans interruption</div>
                        </div>
                    </div>
                    
                    <div class="premium-feature">
                        <span class="feature-icon">üé®</span>
                        <div class="feature-info">
                            <div class="feature-title">Badge Premium</div>
                            <div class="feature-desc">Montre ton statut VIP</div>
                        </div>
                    </div>
                </div>
                
                <button class="shop-buy-btn premium-buy-btn" onclick="buyPremium('monthly')">
                    ‚≠ê Devenir Premium - 9,99‚Ç¨/mois
                </button>
                
                <div class="premium-plans">
                    <button class="plan-btn" onclick="buyPremium('yearly')">
                        <div class="plan-badge">-40%</div>
                        <div class="plan-name">Annuel</div>
                        <div class="plan-price">5,99‚Ç¨/mois</div>
                        <div class="plan-total">71,88‚Ç¨ factur√© annuellement</div>
                    </button>
                </div>
            </div>
        `;
    } else if (tab === 'credits') {
        return `
            <div class="credits-showcase">
                <div class="credits-info">
                    <p>üíé Les cr√©dits te permettent de swiper et matcher sans limite !</p>
                    <p>1 cr√©dit = 1 swipe ou 1 match</p>
                </div>
                
                <div class="credits-grid">
                    <div class="credit-pack" onclick="buyCredits(50, 2.99)">
                        <div class="pack-emoji">ü•â</div>
                        <div class="pack-name">Pack Starter</div>
                        <div class="pack-credits">50 cr√©dits</div>
                        <div class="pack-price">2,99‚Ç¨</div>
                        <div class="pack-value">0,06‚Ç¨/cr√©dit</div>
                    </div>
                    
                    <div class="credit-pack popular" onclick="buyCredits(150, 6.99)">
                        <div class="pack-badge">üî• POPULAIRE</div>
                        <div class="pack-emoji">ü•à</div>
                        <div class="pack-name">Pack Popular</div>
                        <div class="pack-credits">150 cr√©dits</div>
                        <div class="pack-bonus">+20 bonus</div>
                        <div class="pack-price">6,99‚Ç¨</div>
                        <div class="pack-value">0,04‚Ç¨/cr√©dit</div>
                    </div>
                    
                    <div class="credit-pack" onclick="buyCredits(300, 11.99)">
                        <div class="pack-emoji">ü•á</div>
                        <div class="pack-name">Pack Mega</div>
                        <div class="pack-credits">300 cr√©dits</div>
                        <div class="pack-bonus">+50 bonus</div>
                        <div class="pack-price">11,99‚Ç¨</div>
                        <div class="pack-value">0,03‚Ç¨/cr√©dit</div>
                    </div>
                    
                    <div class="credit-pack vip" onclick="buyCredits(1000, 29.99)">
                        <div class="pack-badge">üëë MEILLEURE VALEUR</div>
                        <div class="pack-emoji">üíé</div>
                        <div class="pack-name">Pack VIP</div>
                        <div class="pack-credits">1000 cr√©dits</div>
                        <div class="pack-bonus">+200 bonus</div>
                        <div class="pack-price">29,99‚Ç¨</div>
                        <div class="pack-value">0,02‚Ç¨/cr√©dit</div>
                    </div>
                </div>
            </div>
        `;
    } else {
        return `
            <div class="boosts-showcase">
                <div class="boosts-info">
                    <p>üöÄ Les boosts mettent ton profil en avant pendant 30 minutes !</p>
                    <p>Tu seras vu 10x plus et augmenteras tes chances de match</p>
                </div>
                
                <div class="boosts-grid">
                    <div class="boost-pack" onclick="buyBoost(1, 3.99)">
                        <div class="boost-emoji">üöÄ</div>
                        <div class="boost-name">1 Boost</div>
                        <div class="boost-duration">30 minutes</div>
                        <div class="boost-price">3,99‚Ç¨</div>
                    </div>
                    
                    <div class="boost-pack popular" onclick="buyBoost(5, 14.99)">
                        <div class="boost-badge">üî• -25%</div>
                        <div class="boost-emoji">üöÄüöÄ</div>
                        <div class="boost-name">5 Boosts</div>
                        <div class="boost-duration">2h30 au total</div>
                        <div class="boost-price">14,99‚Ç¨</div>
                        <div class="boost-value">3,00‚Ç¨/boost</div>
                    </div>
                    
                    <div class="boost-pack" onclick="buyBoost(10, 24.99)">
                        <div class="boost-badge">üíé -40%</div>
                        <div class="boost-emoji">üöÄüöÄüöÄ</div>
                        <div class="boost-name">10 Boosts</div>
                        <div class="boost-duration">5h au total</div>
                        <div class="boost-price">24,99‚Ç¨</div>
                        <div class="boost-value">2,50‚Ç¨/boost</div>
                    </div>
                </div>
            </div>
        `;
    }
}

function switchShopTab(tab) {
    document.querySelectorAll('.shop-tab').forEach(t => t.classList.remove('active'));
    event.target.classList.add('active');
    document.getElementById('shop-body').innerHTML = getShopContent(tab);
}

function buyPremium(plan) {
    const prices = {
        monthly: { amount: '9,99‚Ç¨', numeric: 9.99 },
        yearly: { amount: '71,88‚Ç¨', numeric: 71.88 }
    };
    
    const planData = prices[plan];
    
    if (confirm(`‚≠ê Confirmer l'achat Premium ${plan === 'yearly' ? 'Annuel' : 'Mensuel'} pour ${planData.amount} ?`)) {
        userStats.isPremium = true;
        userStats.swipesLeft = 999999;
        userStats.matchesLeft = 999999;
        userStats.credits = 999999;
        
       
        addPurchase(
            'premium',
            null,
            planData.numeric,
            `Abonnement Premium ${plan === 'yearly' ? 'Annuel' : 'Mensuel'}`
        );
        
        
        activateSubscription(plan, planData.numeric);
        
        saveUserStats();
        closeModal();
        closeBlurOverlay();
        showNotification('‚≠ê', 'Bienvenue dans Premium !');
        updateStatsDisplay();
        updateSubscriptionDisplay();
    }
}

function buyCredits(amount, price) {
    if (confirm(`üíé Acheter ${amount} cr√©dits pour ${price}‚Ç¨ ?`)) {
        userStats.credits += amount;
        
      
        addPurchase(
            'credits',
            amount,
            price,
            `Pack de ${amount} cr√©dits`
        );
        
        saveUserStats();
        closeModal();
        closeBlurOverlay();
        showNotification('üíé', `+${amount} cr√©dits ajout√©s !`);
        updateStatsDisplay();
    }
}

function buyBoost(amount, price) {
    if (confirm(`üöÄ Acheter ${amount} boost${amount > 1 ? 's' : ''} pour ${price}‚Ç¨ ?`)) {
        
        addPurchase(
            'boost',
            amount,
            price,
            `Pack de ${amount} boost${amount > 1 ? 's' : ''}`
        );
        
        saveUserStats();
        showNotification('üöÄ', `${amount} boost${amount > 1 ? 's' : ''} ajout√©${amount > 1 ? 's' : ''} !`);
        closeModal();
    }
}

function showCreditModal() {
    const modal = document.createElement('div');
    modal.className = 'modal-overlay';
    modal.innerHTML = `
        <div class="modal-content credit-modal">
            <div class="modal-header">
                <div class="modal-title">üíé Plus de cr√©dits !</div>
                <div class="modal-subtitle">Tu as √©puis√© tous tes swipes gratuits</div>
            </div>
            
            <div class="credit-options">
                <div class="credit-card premium-card" onclick="selectPremium()">
                    <div class="credit-badge">‚≠ê PREMIUM</div>
                    <div class="credit-title">Abonnement Premium</div>
                    <div class="credit-price">9,99‚Ç¨<span>/mois</span></div>
                    <div class="credit-features">
                        <div class="credit-feature">‚úÖ Swipes illimit√©s</div>
                        <div class="credit-feature">‚úÖ Voir qui te like</div>
                        <div class="credit-feature">‚úÖ 5 super likes/jour</div>
                        <div class="credit-feature">‚úÖ Boost mensuel</div>
                        <div class="credit-feature">‚úÖ Pas de pubs</div>
                    </div>
                </div>
                
                <div class="credit-card" onclick="buyCredits(50, 'free')">
                    <div class="credit-emoji">üéÅ</div>
                    <div class="credit-title">Cadeau gratuit</div>
                    <div class="credit-price">Gratuit</div>
                    <div class="credit-desc">+50 swipes gratuits<br><small>Reviens demain pour plus !</small></div>
                </div>
                
                <div class="credit-card" onclick="buyCredits(100, 2.99)">
                    <div class="credit-emoji">üí∞</div>
                    <div class="credit-title">Pack Starter</div>
                    <div class="credit-price">2,99‚Ç¨</div>
                    <div class="credit-desc">+100 cr√©dits</div>
                </div>
                
                <div class="credit-card" onclick="buyCredits(250, 5.99)">
                    <div class="credit-emoji">üíé</div>
                    <div class="credit-title">Pack Popular</div>
                    <div class="credit-price">5,99‚Ç¨</div>
                    <div class="credit-desc">+250 cr√©dits<br><small>+20% bonus</small></div>
                </div>
                
                <div class="credit-card" onclick="buyCredits(500, 9.99)">
                    <div class="credit-emoji">üëë</div>
                    <div class="credit-title">Pack Mega</div>
                    <div class="credit-price">9,99‚Ç¨</div>
                    <div class="credit-desc">+500 cr√©dits<br><small>+50% bonus</small></div>
                </div>
            </div>
            
            <div class="modal-actions">
                <button class="modal-btn modal-btn-cancel" onclick="closeModal()">Peut-√™tre plus tard</button>
            </div>
        </div>
    `;
    
    document.body.appendChild(modal);
    modal.onclick = (e) => {
        if (e.target === modal) closeModal();
    };
}

function selectPremium() {
    if (confirm('üåü Activer Premium pour 9,99‚Ç¨/mois ?\n\n‚úÖ Swipes illimit√©s\n‚úÖ Voir qui te like\n‚úÖ 5 super likes/jour\n‚úÖ Boost mensuel\n‚úÖ Pas de pubs')) {
        userStats.isPremium = true;
        userStats.credits = 999999;
        userStats.swipesLeft = 999999;
        saveUserStats();
        closeModal();
        showNotification('‚≠ê', 'Bienvenue dans Premium !');
        updateStatsDisplay();
    }
}

function buyCredits(amount, price) {
    if (price === 'free') {
        const lastFree = localStorage.getItem('lastFreeCredits');
        const now = new Date().toDateString();
        
        if (lastFree === now) {
            alert('üéÅ Tu as d√©j√† r√©cup√©r√© tes cr√©dits gratuits aujourd\'hui !\nReviens demain pour plus üòä');
            return;
        }
        
        userStats.swipesLeft += amount;
        localStorage.setItem('lastFreeCredits', now);
        saveUserStats();
        closeModal();
        showNotification('üéÅ', `+${amount} swipes gratuits !`);
        updateStatsDisplay();
    } else {
        if (confirm(`üí∞ Acheter ${amount} cr√©dits pour ${price}‚Ç¨ ?`)) {
            userStats.credits += amount;
            saveUserStats();
            closeModal();
            showNotification('üíé', `+${amount} cr√©dits ajout√©s !`);
            updateStatsDisplay();
        }
    }
}

function updateStatsDisplay() {
    const creditsDisplay = document.getElementById('credits-display');
    if (creditsDisplay) {
        if (userStats.isPremium) {
            creditsDisplay.innerHTML = '‚≠ê Premium';
            creditsDisplay.classList.add('premium');
            creditsDisplay.classList.remove('low-credits');
        } else {
            creditsDisplay.innerHTML = `üî• ${userStats.swipesLeft} | üíé ${userStats.credits}`;
            creditsDisplay.classList.remove('premium');
            
            // Ajouter alerte visuelle si cr√©dits bas
            if (userStats.swipesLeft <= 0 && userStats.credits <= 5) {
                creditsDisplay.classList.add('low-credits');
            } else {
                creditsDisplay.classList.remove('low-credits');
            }
        }
    }
}

function saveSettings() {
    localStorage.setItem('altMatchSettings', JSON.stringify(appSettings));
}

function applySettings() {
    if (appSettings.theme === 'dark') {
        document.body.classList.add('dark-theme');
        if (document.getElementById('current-theme-display')) {
            document.getElementById('current-theme-display').textContent = 'Sombre';
        }
    } else {
        document.body.classList.remove('dark-theme');
        if (document.getElementById('current-theme-display')) {
            document.getElementById('current-theme-display').textContent = 'Color√©';
        }
    }
    
    if (document.getElementById('music-toggle')) {
        document.getElementById('music-toggle').checked = appSettings.musicEnabled;
        document.getElementById('music-status').textContent = appSettings.musicEnabled ? 'Activ√©e' : 'D√©sactiv√©e';
    }
    
    if (document.getElementById('notif-toggle')) {
        document.getElementById('notif-toggle').checked = appSettings.notificationsEnabled;
        document.getElementById('notif-status').textContent = appSettings.notificationsEnabled ? 'Activ√©es' : 'D√©sactiv√©es';
    }
}

// Notifications
function showNotification(emoji, message) {
    if (!appSettings.notificationsEnabled) return;
    
    const notification = document.createElement('div');
    notification.className = 'notification';
    notification.innerHTML = `
        <div class="notification-emoji">${emoji}</div>
        <div class="notification-message">${message}</div>
    `;
    
    document.body.appendChild(notification);
    
    setTimeout(() => {
        if (document.body.contains(notification)) {
            document.body.removeChild(notification);
        }
    }, 3000);
}

function showSettings() {
    document.getElementById('swipe-screen').classList.add('hidden');
    document.getElementById('messages-screen').classList.add('hidden');
    document.getElementById('settings-screen').classList.remove('hidden');
    
    if (currentUser) {
        document.getElementById('user-initial').textContent = currentUser.firstname.charAt(0).toUpperCase();
        document.getElementById('user-name-display').textContent = `${currentUser.firstname} ${currentUser.lastname}`;
        document.getElementById('user-email-display').textContent = currentUser.email;
    }
    
    const fruitNames = {
        'peche': 'P√™che üçë',
        'raisin': 'Raisin üçá',
        'pasteque': 'Past√®que üçâ',
        'cerise': 'Cerise üçí',
        'fraise': 'Fraise üçì'
    };
    document.getElementById('current-fruit-display').textContent = fruitNames[selectedFruit] || 'Non s√©lectionn√©';
    
    applySettings();
    updateSubscriptionDisplay();
}
function showProfileEditor() {
    const modal = document.createElement('div');
    modal.className = 'modal-overlay';
    modal.innerHTML = `
        <div class="modal-content profile-editor-modal">
            <div class="modal-header">
                <div class="modal-title">‚úèÔ∏è Modifier mon profil</div>
                <div class="modal-subtitle">Personnalise ton profil</div>
            </div>
            
            <div class="profile-editor-content">
                <div class="profile-picture-section">
                    <div class="profile-picture-preview" id="pp-preview">
                        ${userStats.profilePicture ? `<img src="${userStats.profilePicture}" alt="Photo de profil">` : `<div class="user-initial">${currentUser.firstname.charAt(0).toUpperCase()}</div>`}
                    </div>
                    <input type="file" id="pp-input" accept="image/*" style="display: none;" onchange="handleProfilePictureChange(event)">
                    <button class="change-pp-btn" onclick="document.getElementById('pp-input').click()">
                        üì∑ Changer la photo
                    </button>
                    <button class="remove-pp-btn" onclick="removeProfilePicture()">
                        üóëÔ∏è Supprimer
                    </button>
                </div>
                
                <div class="form-group">
                    <label class="form-label">‚ú® Bio</label>
                    <textarea id="edit-bio" class="form-input" placeholder="Parle-nous de toi..." rows="4">${currentUser.bio || ''}</textarea>
                    <div class="bio-counter"><span id="bio-count">0</span>/200</div>
                </div>
                
                <div class="stats-preview">
                    <div class="stat-item">
                        <div class="stat-icon">üëÅÔ∏è</div>
                        <div class="stat-info">
                            <div class="stat-value">${userStats.profileViews}</div>
                            <div class="stat-label">Vues de profil</div>
                        </div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-icon">üíï</div>
                        <div class="stat-info">
                            <div class="stat-value">${matches.length}</div>
                            <div class="stat-label">Matchs</div>
                        </div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-icon">üíé</div>
                        <div class="stat-info">
                            <div class="stat-value">${userStats.isPremium ? '‚àû' : userStats.credits + userStats.swipesLeft}</div>
                            <div class="stat-label">Cr√©dits</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="modal-actions">
                <button class="modal-btn modal-btn-cancel" onclick="closeModal()">Annuler</button>
                <button class="modal-btn modal-btn-confirm" onclick="saveProfileChanges()">Enregistrer</button>
            </div>
        </div>
    `;
    
    document.body.appendChild(modal);
    modal.onclick = (e) => {
        if (e.target === modal) closeModal();
    };
    

    const bioTextarea = document.getElementById('edit-bio');
    const bioCount = document.getElementById('bio-count');
    bioCount.textContent = bioTextarea.value.length;
    
    bioTextarea.addEventListener('input', () => {
        const length = bioTextarea.value.length;
        bioCount.textContent = length;
        if (length > 200) {
            bioTextarea.value = bioTextarea.value.substring(0, 200);
            bioCount.textContent = 200;
        }
    });
}

function handleProfilePictureChange(event) {
    const file = event.target.files[0];
    if (file) {
        const reader = new FileReader();
        reader.onload = function(e) {
            userStats.profilePicture = e.target.result;
            document.getElementById('pp-preview').innerHTML = `<img src="${e.target.result}" alt="Photo de profil">`;
            saveUserStats();
        };
        reader.readAsDataURL(file);
    }
}

function removeProfilePicture() {
    if (confirm('Supprimer ta photo de profil ?')) {
        userStats.profilePicture = null;
        document.getElementById('pp-preview').innerHTML = `<div class="user-initial">${currentUser.firstname.charAt(0).toUpperCase()}</div>`;
        saveUserStats();
        showNotification('üóëÔ∏è', 'Photo supprim√©e');
    }
}

function saveProfileChanges() {
    const newBio = document.getElementById('edit-bio').value;
    currentUser.bio = newBio;
    localStorage.setItem('altMatchUser', JSON.stringify(currentUser));
    
    closeModal();
    showNotification('‚úÖ', 'Profil mis √† jour !');
    

    if (!document.getElementById('settings-screen').classList.contains('hidden')) {
        showSettings();
    }
}
// D√©connexion
function logout() {
    if (confirm('Es-tu s√ªr de vouloir te d√©connecter ?')) {
      
        localStorage.removeItem('altMatchSession');
        currentUser = null;
        currentSession = null;
        selectedFruit = null;
        profiles = [];
        matches = [];
        currentIndex = 0;
        currentChat = null;
        
        document.getElementById('settings-screen').classList.add('hidden');
        document.getElementById('top-nav').classList.add('hidden');
        document.getElementById('welcome-screen').classList.remove('hidden');
        
        showNotification('üëã', '√Ä bient√¥t !');
    }
}


function changeTheme() {
    appSettings.theme = appSettings.theme === 'colorful' ? 'dark' : 'colorful';
    saveSettings();
    applySettings();
    
    const themeName = appSettings.theme === 'dark' ? 'sombre' : 'color√©';
    showNotification('üé®', `Th√®me ${themeName} activ√© !`);
}

// Toggle notifications
function toggleNotifications() {
    appSettings.notificationsEnabled = document.getElementById('notif-toggle').checked;
    saveSettings();
    document.getElementById('notif-status').textContent = appSettings.notificationsEnabled ? 'Activ√©es' : 'D√©sactiv√©es';
}

// Changer de fruit
function changeFruit() {
    const modal = document.createElement('div');
    modal.className = 'modal-overlay';
    modal.innerHTML = `
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">üçì Changer de fruit</div>
                <div class="modal-subtitle">Choisis ta nouvelle vibe</div>
            </div>
            
            <div class="modal-fruit-options">
                <div class="modal-fruit-card ${selectedFruit === 'peche' ? 'selected' : ''}" onclick="selectModalFruit('peche')">
                    <div class="modal-fruit-emoji">üçë</div>
                    <div class="modal-fruit-info">
                        <div class="modal-fruit-name">P√™che</div>
                        <div class="modal-fruit-desc">Fun et d√©contract√©</div>
                    </div>
                </div>
                
                <div class="modal-fruit-card ${selectedFruit === 'raisin' ? 'selected' : ''}" onclick="selectModalFruit('raisin')">
                    <div class="modal-fruit-emoji">üçá</div>
                    <div class="modal-fruit-info">
                        <div class="modal-fruit-name">Raisin</div>
                        <div class="modal-fruit-desc">Sortir et faire la f√™te</div>
                    </div>
                </div>
                
                <div class="modal-fruit-card ${selectedFruit === 'pasteque' ? 'selected' : ''}" onclick="selectModalFruit('pasteque')">
                    <div class="modal-fruit-emoji">üçâ</div>
                    <div class="modal-fruit-info">
                        <div class="modal-fruit-name">Past√®que</div>
                        <div class="modal-fruit-desc">Chill et amiti√©</div>
                    </div>
                </div>
                
                <div class="modal-fruit-card ${selectedFruit === 'cerise' ? 'selected' : ''}" onclick="selectModalFruit('cerise')">
                    <div class="modal-fruit-emoji">üçí</div>
                    <div class="modal-fruit-info">
                        <div class="modal-fruit-name">Cerise</div>
                        <div class="modal-fruit-desc">Relation s√©rieuse</div>
                    </div>
                </div>
                
                <div class="modal-fruit-card ${selectedFruit === 'fraise' ? 'selected' : ''}" onclick="selectModalFruit('fraise')">
                    <div class="modal-fruit-emoji">üçì</div>
                    <div class="modal-fruit-info">
                        <div class="modal-fruit-name">Fraise</div>
                        <div class="modal-fruit-desc">Romance et sweet vibes</div>
                    </div>
                </div>
            </div>
            
            <div class="modal-actions">
                <button class="modal-btn modal-btn-cancel" onclick="closeModal()">Annuler</button>
                <button class="modal-btn modal-btn-confirm" onclick="confirmFruitChange()">Confirmer</button>
            </div>
        </div>
    `;
    
    document.body.appendChild(modal);
    modal.onclick = (e) => {
        if (e.target === modal) closeModal();
    };
}

let tempSelectedFruit = selectedFruit;

function selectModalFruit(fruit) {
    tempSelectedFruit = fruit;
    document.querySelectorAll('.modal-fruit-card').forEach(card => {
        card.classList.remove('selected');
    });
    event.currentTarget.classList.add('selected');
}

function confirmFruitChange() {
    selectedFruit = tempSelectedFruit;
    localStorage.setItem('altMatchSelectedFruit', selectedFruit);
    
    const fruitNames = {
        'peche': 'P√™che üçë',
        'raisin': 'Raisin üçá',
        'pasteque': 'Past√®que üçâ',
        'cerise': 'Cerise üçí',
        'fraise': 'Fraise üçì'
    };
    
    document.getElementById('current-fruit-display').textContent = fruitNames[selectedFruit];
    document.getElementById('fruit-header').textContent = fruitNames[selectedFruit];
    
    currentIndex = 0;
    generateProfiles();
    showProfile(0);
    
    closeModal();
    showNotification('‚ú®', `Fruit chang√© en ${fruitNames[selectedFruit]} !`);
}

function closeModal() {
    const modal = document.querySelector('.modal-overlay');
    if (modal) {
        document.body.removeChild(modal);
    }
}


function initMusicPlayer() {
    audioPlayer = document.getElementById('audio-player');
    
    if (!audioPlayer) {
        console.error('Audio player not found');
        return;
    }
    
    renderPlaylist();
    loadTrack(0);
    
    audioPlayer.addEventListener('timeupdate', updateProgress);
    audioPlayer.addEventListener('ended', nextTrack);
    audioPlayer.addEventListener('error', function(e) {
        console.error('Audio error:', e);
    });
    
    audioPlayer.volume = 0.7;
}

function renderPlaylist() {
    const playlistContainer = document.getElementById('playlist');
    if (!playlistContainer) return;
    
    playlistContainer.innerHTML = '';
    
    playlist.forEach((track, index) => {
        const item = document.createElement('div');
        item.className = 'playlist-item' + (index === currentTrackIndex ? ' active' : '');
        item.innerHTML = `
            <div class="playlist-item-name">${track.cover} ${track.name}</div>
            <div class="playlist-item-artist">${track.artist}</div>
        `;
        item.onclick = () => {
            loadTrack(index);
            if (appSettings.musicEnabled) {
                playTrack();
            }
        };
        playlistContainer.appendChild(item);
    });
    
    document.getElementById('playlist-count').textContent = `(${playlist.length})`;
}

function loadTrack(index) {
    if (!audioPlayer) return;
    
    currentTrackIndex = index;
    const track = playlist[index];
    
    document.getElementById('track-name').textContent = track.name;
    document.getElementById('track-artist').textContent = track.artist;
    document.getElementById('music-cover').textContent = track.cover;
    
    audioPlayer.pause();
    audioPlayer.src = track.url;
    audioPlayer.load();
    
    document.querySelectorAll('.playlist-item').forEach((item, i) => {
        item.classList.toggle('active', i === index);
    });
    
    document.getElementById('progress-fill').style.width = '0%';
    document.getElementById('current-time').textContent = '0:00';
}

function togglePlay() {
    if (isPlaying) {
        pauseTrack();
    } else {
        playTrack();
    }
}

function playTrack() {
    if (!audioPlayer || !audioPlayer.src) return;
    
    audioPlayer.play().then(() => {
        isPlaying = true;
        document.getElementById('play-pause-btn').textContent = '‚è∏';
        console.log('Playing:', playlist[currentTrackIndex].name);
    }).catch(error => {
        console.error('Play error:', error);
        isPlaying = false;
        document.getElementById('play-pause-btn').textContent = '‚ñ∂';
    });
}

function pauseTrack() {
    if (!audioPlayer) return;
    audioPlayer.pause();
    isPlaying = false;
    document.getElementById('play-pause-btn').textContent = '‚ñ∂';
}

function nextTrack() {
    currentTrackIndex = (currentTrackIndex + 1) % playlist.length;
    loadTrack(currentTrackIndex);
    if (isPlaying) {
        setTimeout(() => playTrack(), 100);
    }
}

function previousTrack() {
    currentTrackIndex = (currentTrackIndex - 1 + playlist.length) % playlist.length;
    loadTrack(currentTrackIndex);
    if (isPlaying) {
        setTimeout(() => playTrack(), 100);
    }
}

function updateProgress() {
    if (!audioPlayer || !audioPlayer.duration) return;
    
    const progress = (audioPlayer.currentTime / audioPlayer.duration) * 100;
    document.getElementById('progress-fill').style.width = progress + '%';
    
    document.getElementById('current-time').textContent = formatTime(audioPlayer.currentTime);
    document.getElementById('total-time').textContent = formatTime(audioPlayer.duration);
}

function seekTrack(event) {
    if (!audioPlayer || !audioPlayer.duration) return;
    
    const progressBar = document.getElementById('progress-bar');
    const rect = progressBar.getBoundingClientRect();
    const clickX = event.clientX - rect.left;
    const width = rect.width;
    const percentage = clickX / width;
    
    audioPlayer.currentTime = percentage * audioPlayer.duration;
}

function changeVolume(value) {
    if (!audioPlayer) return;
    audioPlayer.volume = value / 100;
}

function formatTime(seconds) {
    if (isNaN(seconds) || !isFinite(seconds)) return '0:00';
    const mins = Math.floor(seconds / 60);
    const secs = Math.floor(seconds % 60);
    return `${mins}:${secs.toString().padStart(2, '0')}`;
}

function togglePlaylist() {
    const playlist = document.getElementById('playlist');
    playlist.classList.toggle('open');
}

function closeMusicPlayer() {
    document.getElementById('music-player').classList.remove('active');
    pauseTrack();
    appSettings.musicEnabled = false;
    document.getElementById('music-toggle').checked = false;
    saveSettings();
    applySettings();
}

function toggleMusic() {
    appSettings.musicEnabled = document.getElementById('music-toggle').checked;
    saveSettings();
    document.getElementById('music-status').textContent = appSettings.musicEnabled ? 'Activ√©e' : 'D√©sactiv√©e';
    
    const musicPlayer = document.getElementById('music-player');
    if (appSettings.musicEnabled) {
        musicPlayer.classList.add('active');
        if (!audioPlayer) {
            initMusicPlayer();
        }
        setTimeout(() => {
            loadTrack(0);
            setTimeout(() => playTrack(), 300);
        }, 200);
    } else {
        musicPlayer.classList.remove('active');
        pauseTrack();
    }
}


const playlist = [
    {
        name: "Chill Vibes",
        artist: "Lofi Beats",
        cover: "üåä",
        url: "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3"
    },
    {
        name: "Summer Days",
        artist: "Acoustic Dreams",
        cover: "‚òÄÔ∏è",
        url: "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-2.mp3"
    },
    {
        name: "Night Drive",
        artist: "Synthwave Mix",
        cover: "üåô",
        url: "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-3.mp3"
    },
    {
        name: "Coffee Shop",
        artist: "Jazz Essentials",
        cover: "‚òï",
        url: "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-4.mp3"
    },
    {
        name: "Forest Walk",
        artist: "Nature Sounds",
        cover: "üå≤",
        url: "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-5.mp3"
    }
];

let currentTrackIndex = 0;
let isPlaying = false;
let audioPlayer = null;

function initMusicPlayer() {
    audioPlayer = document.getElementById('audio-player');
    
    if (!audioPlayer) {
        console.error('Audio player not found');
        return;
    }
    
    renderPlaylist();
    loadTrack(0);
  
    audioPlayer.addEventListener('timeupdate', updateProgress);
    audioPlayer.addEventListener('ended', nextTrack);
    audioPlayer.addEventListener('loadedmetadata', function() {
        console.log('Track loaded:', playlist[currentTrackIndex].name);
    });
    audioPlayer.addEventListener('error', function(e) {
        console.error('Audio error:', e);
        showNotification('‚ùå', 'Erreur de chargement de la musique');
    });
    
    // Volume initial
    audioPlayer.volume = 0.7;
}

function renderPlaylist() {
    const playlistContainer = document.getElementById('playlist');
    if (!playlistContainer) return;
    
    playlistContainer.innerHTML = '';
    
    playlist.forEach((track, index) => {
        const item = document.createElement('div');
        item.className = 'playlist-item' + (index === currentTrackIndex ? ' active' : '');
        item.innerHTML = `
            <div class="playlist-item-name">${track.cover} ${track.name}</div>
            <div class="playlist-item-artist">${track.artist}</div>
        `;
        item.onclick = () => {
            loadTrack(index);
            if (appSettings.musicEnabled) {
                playTrack();
            }
        };
        playlistContainer.appendChild(item);
    });
    
    document.getElementById('playlist-count').textContent = `(${playlist.length})`;
}

function loadTrack(index) {
    if (!audioPlayer) {
        console.error('Audio player not initialized');
        return;
    }
    
    currentTrackIndex = index;
    const track = playlist[index];
    
    console.log('Loading track:', track.name, track.url);
    
    document.getElementById('track-name').textContent = track.name;
    document.getElementById('track-artist').textContent = track.artist;
    document.getElementById('music-cover').textContent = track.cover;
    
    // Pause avant de changer
    audioPlayer.pause();
    audioPlayer.src = track.url;
    audioPlayer.load();
    
  
    document.querySelectorAll('.playlist-item').forEach((item, i) => {
        item.classList.toggle('active', i === index);
    });
    
    // Reset progress
    document.getElementById('progress-fill').style.width = '0%';
    document.getElementById('current-time').textContent = '0:00';
}

function togglePlay() {
    if (isPlaying) {
        pauseTrack();
    } else {
        playTrack();
    }
}

function playTrack() {
    if (!audioPlayer) {
        console.error('audioPlayer is null');
        showNotification('‚ùå', 'Lecteur audio non initialis√©');
        return;
    }
    
    if (!audioPlayer.src || audioPlayer.src === '') {
        console.error('No audio source');
        showNotification('‚ùå', 'Aucune source audio');
        loadTrack(0);
        return;
    }
    
    console.log('Attempting to play:', audioPlayer.src);
    
    audioPlayer.play().then(() => {
        isPlaying = true;
        document.getElementById('play-pause-btn').textContent = '‚è∏';
        console.log('‚úÖ Playing:', playlist[currentTrackIndex].name);
        showNotification('üéµ', `Lecture : ${playlist[currentTrackIndex].name}`);
    }).catch(error => {
        console.error('‚ùå Play error:', error);
        showNotification('‚ùå', 'Erreur : ' + error.message);
        isPlaying = false;
        document.getElementById('play-pause-btn').textContent = '‚ñ∂';
    });
}

function pauseTrack() {
    if (!audioPlayer) return;
    
    audioPlayer.pause();
    isPlaying = false;
    document.getElementById('play-pause-btn').textContent = '‚ñ∂';
}

function nextTrack() {
    currentTrackIndex = (currentTrackIndex + 1) % playlist.length;
    loadTrack(currentTrackIndex);
    if (appSettings.musicEnabled && isPlaying) {
        setTimeout(() => playTrack(), 100);
    }
}

function previousTrack() {
    currentTrackIndex = (currentTrackIndex - 1 + playlist.length) % playlist.length;
    loadTrack(currentTrackIndex);
    if (appSettings.musicEnabled && isPlaying) {
        setTimeout(() => playTrack(), 100);
    }
}

function updateProgress() {
    if (!audioPlayer || !audioPlayer.duration) return;
    
    const progress = (audioPlayer.currentTime / audioPlayer.duration) * 100;
    document.getElementById('progress-fill').style.width = progress + '%';
    
    document.getElementById('current-time').textContent = formatTime(audioPlayer.currentTime);
    document.getElementById('total-time').textContent = formatTime(audioPlayer.duration);
}

function seekTrack(event) {
    if (!audioPlayer || !audioPlayer.duration) return;
    
    const progressBar = document.getElementById('progress-bar');
    const rect = progressBar.getBoundingClientRect();
    const clickX = event.clientX - rect.left;
    const width = rect.width;
    const percentage = clickX / width;
    
    audioPlayer.currentTime = percentage * audioPlayer.duration;
}

function changeVolume(value) {
    if (!audioPlayer) return;
    audioPlayer.volume = value / 100;
}

function formatTime(seconds) {
    if (isNaN(seconds) || !isFinite(seconds)) return '0:00';
    const mins = Math.floor(seconds / 60);
    const secs = Math.floor(seconds % 60);
    return `${mins}:${secs.toString().padStart(2, '0')}`;
}

function togglePlaylist() {
    const playlist = document.getElementById('playlist');
    playlist.classList.toggle('open');
}

function closeMusicPlayer() {
    document.getElementById('music-player').classList.remove('active');
    pauseTrack();
    appSettings.musicEnabled = false;
    document.getElementById('music-toggle').checked = false;
    saveSettings();
    applySettings();
}

function toggleMusic() {
    appSettings.musicEnabled = document.getElementById('music-toggle').checked;
    saveSettings();
    document.getElementById('music-status').textContent = appSettings.musicEnabled ? 'Activ√©e' : 'D√©sactiv√©e';
    
    const musicPlayer = document.getElementById('music-player');
    if (appSettings.musicEnabled) {
        musicPlayer.classList.add('active');
        if (!audioPlayer) {
            initMusicPlayer();
        }
        
        setTimeout(() => {
            loadTrack(0);
            setTimeout(() => playTrack(), 200);
        }, 300);
        showNotification('üéµ', 'Musique activ√©e !');
    } else {
        musicPlayer.classList.remove('active');
        pauseTrack();
        showNotification('üéµ', 'Musique d√©sactiv√©e');
    }
}


window.addEventListener('DOMContentLoaded', () => {
    loadSettings();
    loadUserStats();
    updateStatsDisplay();
    
    // Simuler des vues al√©atoires toutes les 30 secondes
    setInterval(() => {
        incrementProfileViews();
        if (!document.getElementById('settings-screen').classList.contains('hidden')) {
            showSettings();
        }
    }, 30000);
    
    setTimeout(() => {
        initMusicPlayer();
    }, 500);
    
    // Charger la session depuis localStorage
    const savedSession = localStorage.getItem('altMatchSession');
    if (savedSession) {
        try {
            const session = JSON.parse(savedSession);
            currentUser = session;
            currentSession = session;
            selectedFruit = session.selected_fruit;
            
            document.getElementById('welcome-screen').classList.add('hidden');
            document.getElementById('fruit-selection').classList.remove('hidden');
            
            document.getElementById('top-nav').classList.add('hidden');
            document.getElementById('swipe-screen').classList.add('hidden');
            
            showNotification('‚ú®', `Bon retour ${session.firstname} !`);
            
            if (selectedFruit) {
                setTimeout(() => {
                    const fruitCards = document.querySelectorAll('.fruit-card');
                    fruitCards.forEach(card => {
                        if (card.getAttribute('onclick').includes(selectedFruit)) {
                            card.style.border = '3px solid #667eea';
                            card.style.boxShadow = '0 0 20px rgba(102, 126, 234, 0.5)';
                        }
                    });
                }, 500);
            }
        } catch (error) {
            console.error('Erreur chargement session:', error);
            localStorage.removeItem('altMatchSession');
        }
    }
    
    if (appSettings.musicEnabled) {
        document.getElementById('music-player').classList.add('active');
    }
});

function initMobileOptimizations() {
    const isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);
    
    if (isMobile) {
        document.body.classList.add('is-mobile');
        
       
        let lastTouchEnd = 0;
        document.addEventListener('touchend', function(event) {
            const now = Date.now();
            if (now - lastTouchEnd <= 300) {
                event.preventDefault();
            }
            lastTouchEnd = now;
        }, false);
        
        //scroll sur ios
        document.addEventListener('touchmove', function(event) {
            if (event.scale !== 1) {
                event.preventDefault();
            }
        }, { passive: false });
        
        
        if ('vibrate' in navigator) {
            document.querySelectorAll('.action-btn, .send-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    navigator.vibrate(10);
                });
            });
        }
    }
}


window.addEventListener('DOMContentLoaded', () => {
    initMobileOptimizations();
    
   
});
// CHATBOT SUPPORT
let supportMessages = [];
let supportAwaitingResponse = false;
let currentSupportTopic = null;

const supportTopics = {
    account: {
        emoji: 'üë§',
        title: 'Probl√®me de compte',
        solutions: [
            'R√©initialiser mot de passe',
            'Modifier mes informations',
            'Supprimer mon compte'
        ],
        responses: {
            'R√©initialiser mot de passe': 'üîê Pour r√©initialiser ton mot de passe :\n\n1. Va dans Param√®tres ‚öôÔ∏è\n2. Clique sur ton profil\n3. S√©lectionne "Changer le mot de passe"\n\nTu peux aussi te d√©connecter et utiliser "Mot de passe oubli√©".',
            'Modifier mes informations': '‚úèÔ∏è Pour modifier tes infos :\n\n1. Va dans Param√®tres ‚öôÔ∏è\n2. Clique sur ton profil en haut\n3. Modifie les champs souhait√©s\n\nTes changements seront sauvegard√©s automatiquement !',
            'Supprimer mon compte': '‚ö†Ô∏è Pour supprimer ton compte :\n\n1. Va dans Param√®tres ‚öôÔ∏è\n2. Scroll tout en bas\n3. Clique sur "Se d√©connecter"\n4. Puis "Supprimer mon compte"\n\n‚ö†Ô∏è Cette action est irr√©versible !'
        }
    },
    match: {
        emoji: 'üíï',
        title: 'Probl√®me de match',
        solutions: [
            'Je ne re√ßois pas de matchs',
            'Comment supprimer un match',
            'Signaler un profil'
        ],
        responses: {
            'Je ne re√ßois pas de matchs': 'üî• Pour augmenter tes chances de match :\n\n‚úÖ Ajoute une bio sympampath!\n‚úÖ Swipe r√©guli√®rement\n‚úÖ Utilise le coup de c≈ìur ‚ú®\n‚úÖ Change de fruit pour explorer\n\nSois patient, les bons matchs arrivent ! üòä',
            'Comment supprimer un match': 'üóëÔ∏è Pour supprimer un match :\n\n1. Va dans Messages üí¨\n2. Swipe vers la gauche sur la conversation\n3. Clique sur "Supprimer"\n\nOu :\n1. Ouvre la conversation\n2. Menu (3 points)\n3. "Supprimer le match"',
            'Signaler un profil': 'üö® Pour signaler un profil :\n\n1. Ouvre le profil concern√©\n2. Clique sur le menu (3 points)\n3. S√©lectionne "Signaler"\n4. Choisis la raison\n\nNous prenons les signalements tr√®s au s√©rieux ! üõ°Ô∏è'
        }
    },
    messages: {
        emoji: 'üí¨',
        title: 'Probl√®me de messages',
        solutions: [
            'Mes messages ne partent pas',
            'Je ne re√ßois pas de notifications',
            'Impossible d\'ouvrir une conversation'
        ],
        responses: {
            'Mes messages ne partent pas': 'üì§ Si tes messages ne partent pas :\n\n1. V√©rifie ta connexion internet\n2. Ferme et rouvre l\'app\n3. V√©rifie que tu n\'es pas bloqu√©\n\nSi le probl√®me persiste, contacte-nous !',
            'Je ne re√ßois pas de notifications': 'üîî Pour activer les notifications :\n\n1. Va dans Param√®tres ‚öôÔ∏è\n2. Active "Notifications"\n3. V√©rifie les param√®tres de ton t√©l√©phone\n\nRed√©marre l\'app apr√®s activation !',
            'Impossible d\'ouvrir une conversation': 'üîß Si tu ne peux pas ouvrir une conversation :\n\n1. Rafra√Æchis la liste des messages\n2. Red√©marre l\'application\n3. V√©rifie que le match existe toujours\n\nLa personne a peut-√™tre supprim√© le match.'
        }
    },
    fruit: {
        emoji: 'üçì',
        title: 'Question sur les fruits',
        solutions: [
            'C\'est quoi les fruits ?',
            'Comment changer de fruit ?',
            'Quel fruit choisir ?'
        ],
        responses: {
            'C\'est quoi les fruits ?': 'üçì Les fruits repr√©sentent ce que tu recherches :\n\nüçë P√™che = Fun & d√©contract√©\nüçá Raisin = F√™te & sorties\nüçâ Past√®que = Chill & amiti√©\nüçí Cerise = Relation s√©rieuse\nüçì Fraise = Romance & cute vibes\n\nChoisis selon ton mood ! ‚ú®',
            'Comment changer de fruit ?': 'üîÑ Pour changer de fruit :\n\n1. Va dans Param√®tres ‚öôÔ∏è\n2. Clique sur "Changer de fruit"\n3. S√©lectionne ton nouveau fruit\n4. Confirme !\n\nTu peux changer quand tu veux ! üéâ',
            'Quel fruit choisir ?': 'ü§î Choisis selon ce que tu cherches :\n\nüíï Amour ? ‚Üí Cerise ou Fraise\nüéâ Fun ? ‚Üí P√™che ou Raisin\nüòé Chill ? ‚Üí Past√®que\n\nTu peux changer √† tout moment selon ton humeur ! üåà'
        }
    },
    other: {
        emoji: '‚ùì',
        title: 'Autre probl√®me',
        solutions: [
            'Bug technique',
            'Suggestion d\'am√©lioration',
            'Contacter le support'
        ],
        responses: {
            'Bug technique': 'üêõ Pour signaler un bug :\n\n1. Note ce que tu faisais quand √ßa a bugu√©\n2. Prends un screenshot si possible\n3. Contacte-nous √† : support@altmatch.com\n\nMerci de nous aider √† am√©liorer l\'app ! üôè',
            'Suggestion d\'am√©lioration': 'üí° On adore tes id√©es !\n\nEnvoie-nous tes suggestions √† :\nüìß suggestions@altmatch.com\n\nOu via nos r√©seaux sociaux :\nüì± @altmatch sur tous les r√©seaux\n\nChaque suggestion est lue ! ‚ú®',
            'Contacter le support': 'üìû Pour nous contacter :\n\nüìß Email : support@altmatch.com\nüí¨ Chat en direct (lun-ven 9h-18h)\nüì± @altmatch sur les r√©seaux\n\nR√©ponse sous 24h maximum ! ‚ö°'
        }
    }
};

function toggleSupportChat() {
    const chat = document.getElementById('support-chat');
    const isActive = chat.classList.toggle('active');
    
    if (isActive && supportMessages.length === 0) {
        setTimeout(() => {
            addSupportBotMessage('üëã Hey ! Je suis l\'assistant support d\'Alt Match. Comment puis-je t\'aider ?');
            setTimeout(() => showSupportMainMenu(), 800);
        }, 300);
    }
}

function addSupportBotMessage(text, showOptions = false) {
    const messageDiv = document.createElement('div');
    messageDiv.className = 'support-message bot';
    
    messageDiv.innerHTML = `
        <div class="support-message-avatar">ü§ñ</div>
        <div class="support-message-content">
            <div class="support-message-bubble">${text}</div>
        </div>
    `;
    
    document.getElementById('support-chat-body').appendChild(messageDiv);
    scrollSupportToBottom();
    
    supportMessages.push({ type: 'bot', text });
}

function addSupportUserMessage(text) {
    const messageDiv = document.createElement('div');
    messageDiv.className = 'support-message user';
    
    messageDiv.innerHTML = `
        <div class="support-message-bubble">${text}</div>
    `;
    
    document.getElementById('support-chat-body').appendChild(messageDiv);
    scrollSupportToBottom();
    
    supportMessages.push({ type: 'user', text });
}

function showSupportTyping() {
    const typingDiv = document.createElement('div');
    typingDiv.className = 'support-message bot';
    typingDiv.id = 'support-typing';
    
    typingDiv.innerHTML = `
        <div class="support-message-avatar">ü§ñ</div>
        <div class="support-typing">
            <div class="support-typing-dot"></div>
            <div class="support-typing-dot"></div>
            <div class="support-typing-dot"></div>
        </div>
    `;
    
    document.getElementById('support-chat-body').appendChild(typingDiv);
    scrollSupportToBottom();
}

function removeSupportTyping() {
    const typing = document.getElementById('support-typing');
    if (typing) typing.remove();
}

function showSupportMainMenu() {
    const optionsDiv = document.createElement('div');
    optionsDiv.className = 'support-options';
    
    Object.keys(supportTopics).forEach(key => {
        const topic = supportTopics[key];
        const btn = document.createElement('button');
        btn.className = 'support-option-btn';
        btn.innerHTML = `
            <span class="support-option-emoji">${topic.emoji}</span>
            <span>${topic.title}</span>
        `;
        btn.onclick = () => selectSupportTopic(key);
        optionsDiv.appendChild(btn);
    });
    
    document.getElementById('support-chat-body').appendChild(optionsDiv);
    scrollSupportToBottom();
}

function selectSupportTopic(topicKey) {
    const topic = supportTopics[topicKey];
    currentSupportTopic = topicKey;
    
    // Retirer les options
    document.querySelectorAll('.support-options').forEach(el => el.remove());
    
    addSupportUserMessage(topic.title);
    
    showSupportTyping();
    setTimeout(() => {
        removeSupportTyping();
        addSupportBotMessage(`${topic.emoji} Parfait ! Quel est exactement ton probl√®me ?`);
        setTimeout(() => showSupportSubMenu(topicKey), 600);
    }, 1000);
}

function showSupportSubMenu(topicKey) {
    const topic = supportTopics[topicKey];
    const optionsDiv = document.createElement('div');
    optionsDiv.className = 'support-options';
    
    topic.solutions.forEach(solution => {
        const btn = document.createElement('button');
        btn.className = 'support-option-btn';
        btn.textContent = solution;
        btn.onclick = () => selectSupportSolution(solution);
        optionsDiv.appendChild(btn);
    });
    
    // Bouton retour
    const backBtn = document.createElement('button');
    backBtn.className = 'support-option-btn';
    backBtn.innerHTML = '<span class="support-option-emoji">‚Üê</span><span>Retour au menu principal</span>';
    backBtn.onclick = () => {
        document.querySelectorAll('.support-options').forEach(el => el.remove());
        addSupportUserMessage('Retour au menu');
        showSupportTyping();
        setTimeout(() => {
            removeSupportTyping();
            addSupportBotMessage('Pas de souci ! Quelle est ta question ?');
            setTimeout(() => showSupportMainMenu(), 600);
        }, 800);
    };
    optionsDiv.appendChild(backBtn);
    
    document.getElementById('support-chat-body').appendChild(optionsDiv);
    scrollSupportToBottom();
}

function selectSupportSolution(solution) {
    document.querySelectorAll('.support-options').forEach(el => el.remove());
    
    addSupportUserMessage(solution);
    
    showSupportTyping();
    setTimeout(() => {
        removeSupportTyping();
        
        const topic = supportTopics[currentSupportTopic];
        const response = topic.responses[solution];
        
        addSupportBotMessage(response);
        
        setTimeout(() => {
            addSupportBotMessage('Est-ce que √ßa r√©pond √† ta question ? üòä');
            setTimeout(() => showSupportFeedback(), 600);
        }, 1500);
    }, 1200);
}

function showSupportFeedback() {
    const optionsDiv = document.createElement('div');
    optionsDiv.className = 'support-options';
    
    const yesBtn = document.createElement('button');
    yesBtn.className = 'support-option-btn';
    yesBtn.innerHTML = '<span class="support-option-emoji">‚úÖ</span><span>Oui, merci !</span>';
    yesBtn.onclick = () => {
        document.querySelectorAll('.support-options').forEach(el => el.remove());
        addSupportUserMessage('Oui, merci !');
        showSupportTyping();
        setTimeout(() => {
            removeSupportTyping();
            addSupportBotMessage('Super ! Ravi d\'avoir pu t\'aider ! üéâ\n\nN\'h√©site pas si tu as d\'autres questions ! üòä');
            setTimeout(() => showSupportMainMenu(), 1000);
        }, 800);
    };
    
    const noBtn = document.createElement('button');
    noBtn.className = 'support-option-btn';
    noBtn.innerHTML = '<span class="support-option-emoji">‚ùå</span><span>Non, j\'ai besoin d\'aide</span>';
    noBtn.onclick = () => {
        document.querySelectorAll('.support-options').forEach(el => el.remove());
        addSupportUserMessage('Non, j\'ai besoin d\'aide');
        showSupportTyping();
        setTimeout(() => {
            removeSupportTyping();
            addSupportBotMessage('Pas de probl√®me ! Tu peux nous contacter directement :\n\nüìß support@altmatch.com\nüí¨ Chat en direct (lun-ven 9h-18h)\n\nNous te r√©pondrons rapidement ! üöÄ');
            setTimeout(() => showSupportMainMenu(), 1500);
        }, 800);
    };
    
    optionsDiv.appendChild(yesBtn);
    optionsDiv.appendChild(noBtn);
    
    document.getElementById('support-chat-body').appendChild(optionsDiv);
    scrollSupportToBottom();
}

function sendSupportMessage() {
    const input = document.getElementById('support-input');
    const text = input.value.trim();
    
    if (!text) return;
    
    addSupportUserMessage(text);
    input.value = '';
    
    showSupportTyping();
    setTimeout(() => {
        removeSupportTyping();
        addSupportBotMessage('Je comprends ta question ! Regarde ces options qui pourraient t\'aider :');
        setTimeout(() => showSupportMainMenu(), 600);
    }, 1200);
}

function handleSupportKeyPress(event) {
    if (event.key === 'Enter') {
        sendSupportMessage();
    }
}

function scrollSupportToBottom() {
    const chatBody = document.getElementById('support-chat-body');
    setTimeout(() => {
        chatBody.scrollTop = chatBody.scrollHeight;
    }, 100);
}
document.addEventListener('DOMContentLoaded', () => {
    const actionButtons = document.querySelectorAll('.action-btn');
    
    actionButtons.forEach(btn => {
        const originalClick = btn.onclick;
        btn.onclick = function(e) {
            // V√©rifier les cr√©dits
            if (!userStats.isPremium && userStats.swipesLeft <= 0 && userStats.credits <= 0) {
                e.preventDefault();
                e.stopPropagation();
                
              
                const card = document.querySelector('.profile-card');
                if (card) {
                    card.classList.add('no-credits');
                    setTimeout(() => {
                        card.classList.remove('no-credits');
                    }, 500);
                }
                
                showBlurOverlay();
                return false;
            }
            
           
            if (originalClick) {
                originalClick.call(this, e);
            }
        };
    });
});
 src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"

const SUPABASE_URL = 'https://dflddxjdmezddqefxpfm.supabase.co';
const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImRmbGRkeGpkbWV6ZGRxZWZ4cGZtIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjMyMTA4NTQsImV4cCI6MjA3ODc4Njg1NH0.dgUIxwiewtXCPj5MxV7oiZvq_59KELDAubLrJNhTmxQ';


let supabase;


document.addEventListener('DOMContentLoaded', () => {
    if (window.supabase) {
        supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY, {
            db: {
                schema: 'public',
            },
            auth: {
                persistSession: false
            },
            global: {
                headers: {
                    'Accept': 'application/json',
                    'Content-Type': 'application/json'
                }
            }
        });
        console.log('‚úÖ Supabase connect√© !');
    } else {
        console.error('‚ùå Supabase non charg√© !');
    }
});

let currentSession = null;

</script>
</body>
</html>











